<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Práctica de operaciones básicas</title>
    <!-- Descripción SEO -->
    <meta
      name="description"
      content="Aprende y practica operaciones matemáticas básicas como suma, resta, multiplicación, división, números enteros, decimales y fracciones de forma interactiva y sencilla."
    />
    <!-- Favicon -->
    <link
      rel="icon"
      href="https://img.icons8.com/ultraviolet/40/math.png"
      type="image/png"
    />
    <style>
               :root {
               --clr-primary: #2563eb;
               --clr-bg: #f8fafc;
               --clr-surface: #ffffff;
               --clr-text: #0f172a;
               --radius: 0.75rem;
               --clr-top: #2563eb;
               /* arriba (azul) */
               --clr-bottom: #a020f0;
               /* abajo (lila) */
               --clr-carry: #f97316;
               /* llevadas (naranja) */
               --clr-result: #c7c900;
               /* resultado (verde) */
               --clr-sign: #475569;
               /* signo (gris) */
               --clr-dividend: #2563eb;
               /* azul                         */
               --clr-divisor: #a020f0;
               /* morado                       */
               --clr-quotient: #c7c900;
               /* amarillo-verdoso             */
               --clr-remainder: #f97316;
               /* naranja                      */
               --clr-step: #475569;
               /* rosa **/
               --clr-rose: #fa73fe;
               --op-min: 2rem;
               --op-max: 3.2rem;
               }
               * {
               box-sizing: border-box;
               }
               body {
               margin: 0;
               font-family: system-ui, sans-serif;
               background: var(--clr-bg);
               color: var(--clr-text);
               padding: 2rem;
               }
               h1 {
               text-align: center;
               margin-bottom: 2rem;
               }
               /* Tabs */
               .tabs {
               display: flex;
               justify-content: center;
               gap: 0.5rem;
               flex-wrap: wrap;
               margin-bottom: 1.5rem;
               }
               .tab {
               padding: 0.5rem 1rem;
               border: none;
               border-radius: var(--radius);
               background: var(--clr-surface);
               cursor: pointer;
               font-weight: 600;
               box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
               transition: background 0.2s;
               }
               .tab:hover {
               background: #e2e8f0;
               }
               .tab.active {
               background: var(--clr-primary);
               color: white;
               }
               /* Instruction & exercise containers */
               #instruction,
               #exercise {
               background: var(--clr-surface);
               border-radius: var(--radius);
               box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
               margin-bottom: 1.5rem;
               padding: 1rem 1.25rem;
               }
               /* Formatting helpers for addition, subtraction, multiplication */
               .operation {
               font-family: "Courier New", monospace;
               font-size: clamp(2rem, 4vw, 3.2rem);
               font-weight: 700;
               width: fit-content;
               line-height: 1.1;
               display: flex;
               /* pila vertical */
               flex-direction: column;
               align-items: flex-end;
               /* alinea a la derecha */
               margin: 0;
               padding: 20px;
               position: relative;
               }


      .operation-vertical {
        font-family: "Courier New", monospace;
        font-size: clamp(1.5rem, 3.5vw, 2.7rem);
        font-weight: 700;
        width: fit-content;
        line-height: 1.1;
        display: flex;
        flex-direction: row;
        align-items: center;
        gap:0.6em;  /* antes tenías 0.4em */
        margin: 0;
        padding: 20px;
        position: relative;
      }

      .operation-vertical-2 {
        font-family: "Courier New", monospace;
        font-size: clamp(1.2rem, 3.2vw, 2.4rem);
        font-weight: 700;
        width: fit-content;
        line-height: 1.1;
        display: flex;
        flex-direction: row;
        align-items: center;
        gap:0.6em;  /* antes tenías 0.4em */
        margin: 0;
        padding: 20px;
        position: relative;
      }

      .hand-circle {
        position: relative;
        display: inline-flex;
        justify-content: center;
        align-items: center;

        /* cuadrado flexible */
        aspect-ratio: 1 / 1;
        min-width: 2.4em;

        /* espacio horizontal para no aplastar el número */
        padding: 0 0.2em;

        vertical-align: middle;
        z-index: 0;
      }

      .hand-circle::before {
        content: "";
        position: absolute;
        inset: 0;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M89.4,47.1c-1.3-15.9-14-29-29.5-31.1c0.4-0.8,0.2-1.8-0.8-2.1c-16.6-3.8-35.9,0.8-44.6,16.5c-8.3,14.9-2.8,33.9,8.9,45.2c11.5,11,28.4,14.6,43.2,8.5C81.2,78,90.7,63.1,89.4,47.1z M69.7,79.4c-12.4,7.1-28,6.3-39.6-2c-12.2-8.5-19.6-24.5-15.7-39.3C19.1,20.4,37.9,13.7,54.5,16c-0.8,0.8-0.5,2.6,0.9,2.6c14,0.1,26.9,10.2,30.2,23.8C89.2,56.7,82.4,72.1,69.7,79.4z' fill='orange'/%3E%3C/svg%3E");
        background-size: cover;
        background-repeat: no-repeat;
        z-index: -1;
        pointer-events: none;
        border-radius: 50%;
      }

      /* Asegura que el sup no desborde */
      sup {
        font-size: 0.5em;
      }

               /* una fila numérica o de signo */
               .op-line {
               display: block;
               margin: 0;
               padding: 0;
               position: relative;
               /* necesario para posicionar .carry dentro */
               }
               .op-label {
               color: var(--clr-step);
               /* gris oscuro */
               font-weight: 600;
               margin-right: 0.3rem;
               }
               .op-top {
               color: var(--clr-top);
               }
               /* número de arriba */
               .op-bottom {
               color: var(--clr-bottom);
               }
      /* CSS */
      .mcm-decomp {
        font-family: "Courier New", monospace;
        font-size: clamp(2rem, 4vw, 3.2rem);
        font-weight: 700;
        padding: 20px;
      }

      .mcm-line {
        display: flex;
        align-items: stretch;   /* La barra crece con las columnas */
      }

      .mcm-left,
      .mcm-right {
        display: flex;
        flex-direction: column;
        gap: 0.2em;             /* Espacio uniforme entre números */
      }

      .mcm-left {
        margin-right: 1rem;
        text-align: right;      /* Alinea los números a la derecha */
      }

      .mcm-right {
        margin-left: 1rem;
      }

      .mcm-left-number {
        color: var(--clr-top);
      }

      .mcm-factor {
        color: var(--clr-bottom);
      }

      .mcm-final {              /* Reutilizada para ambos lados */
        color: var(--clr-result);
      }

      .mcm-bar {
        width: 4px;
        background-color: black;
      }


               /*  ▸  regla ÚNICA para TODOS los carries                 */
               /*  ▸  funciona en .operation y en .long-division          */
               /* separacion visual entre cifras = 0.5ch sin encoger el bloque */
               .op-digit {
               display: inline-block;
               width: 1ch;
               /* ➜ NO se toca               */
               text-align: center;
               margin-left: -0.5ch;
               /* ➜ solapa medio carácter    */
               }
               /* el primer dígito de cada línea no necesita el margen negativo */
               .op-line .op-digit:first-child {
               margin-left: 0;
               }
               /* Número original tachado */
               .strike {
               display: block;
               /* ocupa todo el ancho de .op-digit  */
               position: relative;
               color: var(--clr-top);
               }
               .strike::after {
               content: '';
               position: absolute;
               left: 0;
               right: 0;
               top: 50%;
               border-top: 3px solid red;
               transform: rotate(-5deg);
               }
               /* Número prestado en naranja */
               .borrowed {
               position: absolute;
               font-size: 0.5em;
               color: var(--clr-carry);
               /* naranja */
               font-weight: bold;
               top: -0.8em;
               left: 0.3em;
               pointer-events: none;
               }
               .operation .carry,
               .long-division .carry {
               position: absolute;
               font-size: 0.5em;
               font-weight: bold;
               color: var(--clr-carry);
               /* posición (x,y) con fallback */
               top: calc(var(--carry-y, -1em));
               left: calc(var(--carry-x, -0.65em));
               line-height: 1;
               pointer-events: none;
               }
               .two-operations {
               margin-top: 12px;
               display: inline-flex;
               }
               .two-divisions {
               margin-top: 12px;
               display: inline-flex;
               }
               .center-arrow{
               margin: auto 30px;
               color: var(--clr-carry);
               font-family: "Courier New", monospace;
               font-weight: 800;
               font-size: 1.2em;
               }
               /* Flecha en tamaño normal */
               .normal-arrow-divisions {
               /* --- Color y relleno --- */
               color: var(--clr-carry);
               fill: currentColor;           /* El SVG hereda el color de texto */
               /* --- Tamaño --- */
               width: clamp(1.5rem, 2.7vw, 3rem);
               height: auto;
               }
               /* --------- PANTALLAS PEQUEÑAS --------- */
               @media (max-width: 720px) {
               .two-divisions {
               /* Muestra uno debajo del otro */
               display: flex;          /* o inline-flex, según necesites */
               flex-direction: column;
               }
               .normal-arrow-divisions {
               transform: rotate(90deg);
               }
               .center-arrow{
               margin: 0 0 0 20%;
               }
               .width-arrow{
                margin: auto 3em !important;
                    display: block;
               }
               .center{
                display: block;
                text-align: center;
               }
               .signo-center{
                display: block;
               }
               }
               .normal-arrow {
               /* --- Color y relleno --- */
               color: var(--clr-carry);
               /* Cambia este valor si quieres otro tono */
               fill: currentColor;
               /* El SVG hereda el color de texto */
               /* --- Tamaño --- */
               width: clamp(1.5rem, 2.7vw, 3rem);
               height: auto;
               }
               /* Clase única que lo hace todo */
               .curved-arrow {
               /* --- Color y relleno --- */
               color: var(--clr-carry);
               /* Cambia este valor si quieres otro tono */
               fill: currentColor;
               /* El SVG hereda el color de texto */
               /* --- Tamaño --- */
               width: clamp(1.5rem, 2.7vw, 3rem);
               height: auto;
               /* --- Rotación 180° --- */
               transform-origin: center;
               }
               .flechas {
               float: left;
               display: inline-flex;
               margin-left: 4px;
               position: relative;
               left: -5px;
               }
               .op-result {
               color: var(--clr-result);
               }
               /* resultado final */
               .op-sign {
               color: var(--clr-sign);
               }
               /* signo de la operación */
               .op-step {
               color: var(--clr-step);
               }
               /* pasos intermedios */
               .operation hr {
               border: none;
               border-top: .25rem solid #000;
               width: 100%;
               /* 100 % del contenedor, que ahora es el ancho del número */
               margin: .1rem 0;
               /* sin espacio vertical extra */
               }
               .step hr {
               border: none;
               border-top: .25rem solid #000;
               width: 100%;
               /* 100 % del contenedor, que ahora es el ancho del número */
               margin: .1rem 0;
               /* sin espacio vertical extra */
               }
               .long-division-line {
               border: none;
               border-top: 0.25rem solid #000;
               width: 2em;
               margin: 0.1rem 0;
               }
               /* Medida por defecto para pantallas “grandes” */
               .iframe {
               width: 560px;
               height: 315px;
               /* 16 : 9 => 560 × 0.5625 */
               }
               /* Cuando el viewport sea de 768 px o menos,
               el ancho pasa a 100 % y la altura se recalcula
               para mantener la relación 16 : 9               */

             @media (max-width: 420px) {
                .two-operations {
                  display: block;
                }
              }

               @media (max-width: 768px) {
               .iframe {
               width: 100%;
               height: calc(100vw * 0.5625);
               /* 100 vw × (9/16) */
               }
               }
               /* ───────────────────────
               División larga “estilo 🇪🇸”
               ─────────────────────── */
               .long-division {
               --stroke: .25rem;
               /* grosor del símbolo en “L”  */
               font-family: "Courier New", monospace;
               font-size: clamp(2.4rem, 4vw, 3.6rem);
               font-weight: 700;
               line-height: 1.10;
               display: flex;
               flex-direction: row;
               align-items: flex-start;
               /* 👈 asegura la parte superior alineada */
               position: relative;
               padding: 40px 0px;
               }
               /* ▌ Dividendo (izquierda) */
               .long-division .dividend-wrapper {
               text-align: right;
               padding-right: 1rem;
               padding-top: 0.25rem;
               color: var(--clr-dividend);
               position: relative;
               }
               /* restos o pasos intermedios dentro del dividendo */
               .long-division .step {
               color: var(--clr-step);
               }
               .long-division .divisor {
               color: var(--clr-divisor);
               position: relative;
               margin-left: 0.6rem;
               /* sitio para línea vertical */
               }
               /* Línea vertical izquierda */
               .long-division .divisor::before {
               content: "";
               position: absolute;
               left: -0.6rem;
               top: 0;
               width: var(--stroke);
               height: 100%;
               background: #000;
               }
               /* Línea horizontal inferior */
               .long-division .divisor::after {
               content: "";
               position: absolute;
               left: -0.6rem;
               bottom: 0;
               width: calc(100% + 0.6rem);
               height: var(--stroke);
               background: #000;
               }
               /* divisor  */
               .long-division .divisor {
               color: var(--clr-divisor);
               position: relative;
               margin-left: 0.6rem;
               padding: 0.1rem 0.4rem 0.3rem 0.6rem;
               display: inline-block;
               }
               /* marca visual para indicar qué cifras se agrupan del dividendo */
               .long-division .pick {
               display: inline-block;
               position: relative;
               padding: 0 0.2rem;
               margin: 0 0.1rem;
               }
               .long-division .pick::after {
               content: "";
               position: absolute;
               bottom: -0.3rem;
               left: -0.3rem;
               width: 100%;
               height: 0.6rem;
               border: 0.25rem solid #000;
               border-top: none;
               border-radius: 0 0 50% 50%;
               }
               .long-division .quotient {
               color: var(--clr-quotient);
               margin-top: 0.6rem;
               padding-left: 0.6rem;
               }
               /* resto (semicírculo) */
               .long-division .remainder {
               position: relative;
               color: var(--clr-remainder);
               margin-top: .30rem;
               padding: 0 .20rem;
               }
               .long-division .step:nth-of-type(even) {
               color: var(--clr-step);
               }
               /* Exercise section */
               #problem {
               font-size: 1.25rem;
               font-weight: 700;
               margin-bottom: 1rem;
               }
               #answerInput {
               width: 280px;
               padding: 0.75rem 1rem;
               font-size: 1rem;
               border: 2px solid #cbd5e1;
               border-radius: var(--radius);
               margin-bottom: 1rem;
               }
               #answerInput:focus {
               outline: none;
               border-color: var(--clr-primary);
               }
               .btn {
               padding: 0.5rem 1.25rem;
               border: none;
               border-radius: var(--radius);
               background: var(--clr-primary);
               color: white;
               font-size: 1rem;
               cursor: pointer;
               margin-right: 0.5rem;
               margin-bottom: 1rem;
               transition: background 0.2s;
               }
               .btn:hover {
               background: #1d4ed8;
               }
               #feedback {
               font-weight: 600;
               min-height: 1.5rem;
               }
               /* ───────────────────────
               NUEVA TABLA DE MULTIPLICAR
               ─────────────────────── */
               .tabla-multiplicar {
               border-collapse: collapse;
               margin-top: 1rem;
               width: 100%;
               max-width: 500px;
               }
               .tabla-multiplicar th,
               .tabla-multiplicar td {
               border: 1px solid #cbd5e1;
               padding: 0.5rem;
               text-align: center;
               }
               .frac {
               display: inline-block;
               text-align: center;
               vertical-align: middle;
               margin-right: 0.3rem;
               line-height: 1;
               }
               /* 🔴 QUITAMOS esto para evitar desbalance de altura */
               #inputDen {
               margin-bottom: 0.5rem;
               }
               /* Inputs en fracciones: altura igual, sin bordes redondeados extras */
               .frac input {
               width: 4rem;
               padding: 0.5rem;
               height: 2.5rem;
               /* 🔧 Fuerza igual altura entre ambos */
               font-size: 1rem;
               border: 2px solid #cbd5e1;
               border-radius: var(--radius);
               text-align: center;
               box-sizing: border-box;
               }
               .frac input:focus {
               outline: none;
               border-color: var(--clr-primary);
               }
               .frac .top,
               .frac .bottom {
               display: block;
               padding: 0.25rem 0;
               }
               .frac .top {
               border-bottom: 3px solid var(--clr-step);
               color: var(--clr-top);
               margin-bottom: 0.25rem;
               }
               .frac .bottom {
               margin-top: 0.25rem;
               color: var(--clr-bottom);
               }
               .frac .separator-frac {
               border-bottom: 3px solid var(--clr-step);
               color: var(--clr-top);
               }
               /* Menú */
               .nav-container {
               position: relative;
               }
               .hamburger {
               display: none;
               font-size: 2rem;
               background: var(--clr-primary);
               color: white;
               border: none;
               padding: 0.5rem 1rem;
               border-radius: var(--radius);
               cursor: pointer;
               margin-bottom: 1rem;
               }
               /* Pantallas pequeñas */
               @media (max-width: 768px) {
               .hamburger {
               display: block;
               }
               .tabs {
               display: none;
               flex-direction: column;
               gap: 0.25rem;
               background: var(--clr-surface);
               padding: 1rem;
               border-radius: var(--radius);
               box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
               }
               .tabs.show {
               display: flex;
               }
               .tab {
               width: 100%;
               text-align: left;
               }
               }
    </style>
  </head>
  <body>
    <h1>Práctica de operaciones básicas</h1>
    <!-- Tabs -->
    <nav class="nav-container">
      <button id="hamburgerBtn" class="hamburger">&#9776;</button>
      <div class="tabs" id="tabsContainer">
        <button class="tab active" data-op="suma">Suma llevando</button>
        <button class="tab" data-op="resta">Resta llevando</button>
        <button class="tab" data-op="tabla">Tabla de multiplicar</button>
        <button class="tab" data-op="multiplicacion">
          Multiplicación 1 cifra llevando
        </button>
        <button class="tab" data-op="division">División 1 cifra</button>
        <button class="tab" data-op="restaSustraendoMayor">
          Resta con sustraendo mayor
        </button>
        <button class="tab" data-op="sumaDecimales">Suma con decimales</button>
        <button class="tab" data-op="restaDecimales">
          Resta con decimales
        </button>
        <button class="tab" data-op="multiplicacion2">
          Multiplicación ≥2 cifras llevando
        </button>
        <button class="tab" data-op="division2">División ≥2 cifras</button>
        <button class="tab" data-op="primos_compuestos">
          Números primos y compuestos
        </button>
        <button class="tab" data-op="descomposicionPrimos">
          Descomposición en factores primos
        </button>
        <button class="tab" data-op="mcm">Mínimo común múltiplo</button>
        <button class="tab" data-op="mcd">Máximo común divisor</button>
        <button class="tab" data-op="simplificarAmplificarFracciones">
          Simplificación y amplificación de fracciones
        </button>
        <button class="tab" data-op="sumaFracciones">Suma de fracciones</button>
        <button class="tab" data-op="restaFracciones">
          Resta de fracciones
        </button>
        <button class="tab" data-op="multiplicacionFracciones">
          Multiplicación de fracciones
        </button>
        <button class="tab" data-op="divisionFracciones">
          División de fracciones
        </button>
        <button class="tab" data-op="sumaEnteros">
          Suma y resta de números enteros
        </button>
        <button class="tab" data-op="multiplicacionEnteros">
          Multiplicación de números enteros
        </button>
        <button class="tab" data-op="divisionEnteros">
          División de números enteros
        </button>
        <button class="tab" data-op="multiplicacionDecimales">
          Multiplicación con decimales
        </button>
        <button class="tab" data-op="divisionDecimales">
          División con decimales
        </button>
        <button class="tab" data-op="potencias">Potencias</button>
        <button class="tab" data-op="operacionesCombinadas">
          Operaciones combinadas
        </button>
      </div>
    </nav>

    <!-- Instruction placeholder -->
    <section id="instruction"></section>
    <!-- Exercise area -->
    <section id="exercise">
      <p id="problem"></p>
      <input
        type="text"
        id="answerInput"
        placeholder="Tu respuesta"
        autofocus="false"
      />
      <br />
      <button id="checkBtn" class="btn">Comprobar</button>
      <button id="newBtn" class="btn">Nuevo ejercicio</button>
      <p id="feedback"></p>
    </section>
    <script>


        function togglePrimos() {
          const div = document.getElementById('tablaPrimos100');
          const btn = document.getElementById('togglePrimosBtn');
          const hidden = div.style.display === 'none';
          div.style.display = hidden ? 'block' : 'none';
          btn.textContent  = hidden ? 'Ocultar' : 'Ver más';
        }

               function toggleTabla() {
               const tabla = document.getElementById("tablaMultiplicar");
               const btn = document.getElementById("toggleTableBtn");
               if (!tabla || !btn) return;
               const oculto = tabla.style.display === "none" || tabla.style.display === "";
               tabla.style.display = oculto ? "block" : "none";
               btn.textContent = oculto ? "Ver menos" : "Ver más";
               }


               /* === Herramientas para manejar fracciones ============================= */

               function gcd(a, b) {             // máximo común divisor
               return b ? gcd(b, a % b) : Math.abs(a);
               }
               function lcm(a, b) {             // mínimo común múltiplo
               return Math.abs(a * b) / gcd(a, b);
               }
               function frac(n, d) {            // crea string 'n/d'
               return `${n}/${d}`;
               }
               function parseFrac(str) {        // pasa 'n/d' a objeto {n,d}
               const [n, d] = String(str).split('/').map(Number);
               return { n, d };
               }
               function reduceFrac({ n, d }) {  // devuelve fracción simplificada
               const g = gcd(n, d);
               return { n: n / g, d: d / g };
               }

               // Devuelve un ENTERO entre min y max (ambos inclusive)
               function rand(min, max) {
               return Math.floor(Math.random() * (max - min + 1)) + min;
               }

               /* Configuración de cada operación */
               const OPERATIONS = {




               /* ------ T A B L A   D E   M U L T I P L I C A R ------ */
               tabla: {
               label: 'Tabla de multiplicar', symbol: '&times;',
               generate: () => [rand(1, 10), rand(1, 10)],
               calc: (a, b) => a * b,
               instructions: `
               			 <h2>Tabla de multiplicar</h2>
               			 <ol>
               			   <li>Para dominar la tabla de multiplicar hay que memorizar los productos de los números del 1&nbsp;al&nbsp;10.</li>
               			   <li>Practica multiplicando los dos números que aparecen. Escribe el resultado y comprueba tu respuesta.</li>
               			   <li>Fíjate si alguno de los factores se repite en otras multiplicaciones: eso te ayudará a interiorizar patrones.</li>
               			 </ol>
               			 <button id="toggleTableBtn" class="btn" onclick="toggleTabla()">Ver más</button>
               			 <div id="tablaMultiplicar" style="display:none;">
               			   <table class="tabla-multiplicar">
               				 <thead>
               				   <tr><th>&times;</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th></tr>
               				 </thead>
               				 <tbody>
               				   <tr><th>1</th><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td></tr>
               				   <tr><th>2</th><td>2</td><td>4</td><td>6</td><td>8</td><td>10</td><td>12</td><td>14</td><td>16</td><td>18</td><td>20</td></tr>
               				   <tr><th>3</th><td>3</td><td>6</td><td>9</td><td>12</td><td>15</td><td>18</td><td>21</td><td>24</td><td>27</td><td>30</td></tr>
               				   <tr><th>4</th><td>4</td><td>8</td><td>12</td><td>16</td><td>20</td><td>24</td><td>28</td><td>32</td><td>36</td><td>40</td></tr>
               				   <tr><th>5</th><td>5</td><td>10</td><td>15</td><td>20</td><td>25</td><td>30</td><td>35</td><td>40</td><td>45</td><td>50</td></tr>
               				   <tr><th>6</th><td>6</td><td>12</td><td>18</td><td>24</td><td>30</td><td>36</td><td>42</td><td>48</td><td>54</td><td>60</td></tr>
               				   <tr><th>7</th><td>7</td><td>14</td><td>21</td><td>28</td><td>35</td><td>42</td><td>49</td><td>56</td><td>63</td><td>70</td></tr>
               				   <tr><th>8</th><td>8</td><td>16</td><td>24</td><td>32</td><td>40</td><td>48</td><td>56</td><td>64</td><td>72</td><td>80</td></tr>
               				   <tr><th>9</th><td>9</td><td>18</td><td>27</td><td>36</td><td>45</td><td>54</td><td>63</td><td>72</td><td>81</td><td>90</td></tr>
               				   <tr><th>10</th><td>10</td><td>20</td><td>30</td><td>40</td><td>50</td><td>60</td><td>70</td><td>80</td><td>90</td><td>100</td></tr>
               				 </tbody>
               			   </table>
               			 </div>`
               },




               /* ---------- M Í N I M O   C O M Ú N   M Ú L T I P L O ---------- */
               mcm: {
               label: 'Mínimo común múltiplo',
               symbol: 'm.c.m.',
               /* ▸ AHORA puede devolver 2, 3 o 4 números */
               generate: () => {
               	  const howMany = Math.random() < 0.15 ? rand(3, 4) : 2;   // 15 % ⇒ 3-4 números
               	  const nums = [];
               	  while (nums.length < howMany) {
               		  const n = rand(6, 60);
               		  if (!nums.includes(n)) nums.push(n);                    // evita repetidos
               	  }
               	  return nums;                                              // ← array tamaño 2-4
               },
               /* ▸ lcm acumulativo para todos los valores */
               calc: (...nums) => nums.reduce((acc, v) => lcm(acc, v)),
               instructions: `
               	   <h2>Mínimo común múltiplo (m.c.m.) con descomposición de factores</h2>

                   <p>En este ejemplo, veremos el m.c.m de los números <strong>165 y 275</strong>.</p>
               	   <ol>
               		 <li>Descompón cada número en factores primos.<br/>
        <!-- HTML -->

        <div class="two-operations">
      <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">165</span>
            <span class="mcm-left-number">55</span>
            <span class="mcm-left-number">11</span>
            <!-- Último número en verde -->
            <span class="mcm-left-number mcm-final">1</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">3</span>
            <span class="mcm-factor">5</span>
            <span class="mcm-factor">11</span>
          </div>
        </div>
      </div>

      <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">275</span>
            <span class="mcm-left-number">55</span>
            <span class="mcm-left-number">11</span>
            <!-- Último número en verde -->
            <span class="mcm-left-number mcm-final">1</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">5</span>
            <span class="mcm-factor">5</span>
            <span class="mcm-factor">11</span>
          </div>
        </div>
      </div>
      </div>



                   </li>
               		 <li>Toma los <strong>factores comunes y no comunes de mayor exponente</strong>.<br/>


      <!-- HTML -->
      <div class="operation-vertical">

      <span style="color: var(--clr-top)">
       165</span> =
        <span style="color: var(--clr-bottom)">
          <span class="hand-circle">3</span> × 5 ×
          <span class="hand-circle">11</span>
        </span>
      </div>

      <div class="operation-vertical">
        <span style="color: var(--clr-top)">275</span> =
         <span style="color: var(--clr-bottom)">
        <span class="hand-circle">
          <span class="number">5<sup>2</sup></span>
        </span> × 11
        </span>
      </div>

      </li>
               		 <li>Multiplica esos factores: el resultado es el m.c.m. <br/>

      <!-- HTML -->
      <div class="operation-vertical">
       <span style="color: var(--clr-bottom)">
      3 × <span class="number">5<sup>2</sup></span> × 11</span></span> = <span style="color: var(--clr-result)">825</span>
      </div>
      <!-- HTML -->
      <div class="operation-vertical-2">
       <span style="color: var(--clr-step)">m.c.m (165, 275) =</span> <span style="color: var(--clr-result)">825</span>
      </div>



      </li>
               	   </ol>

                            	   <iframe class="iframe" src="https://www.youtube.com/embed/ADcPfyt6LvY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>




                   `
               },


               /* ---------- M Á X I M O   C O M Ú N   D I V I S O R ---------- */
               mcd: {
               label: 'Máximo común divisor',
               symbol: 'm.c.d.',
               generate: () => {
               	  const howMany = Math.random() < 0.15 ? rand(3, 4) : 2;    // 15 % ⇒ 3-4 números
               	  const nums = [];
               	  while (nums.length < howMany) {
               		  const n = rand(20, 120);
               		  if (!nums.includes(n)) nums.push(n);
               	  }
               	  return nums;
               },
               /* ▸ gcd acumulativo para todos los valores */
               calc: (...nums) => nums.reduce((acc, v) => gcd(acc, v)),
               instructions: `
               	           	   <h2>Máximo común divisor (m.c.d.) con descomposición de factores</h2>


                   <p>En este ejemplo, veremos el m.c.d de los números <strong>240 y 300</strong>.</p>
               	   <ol>
               		 <li>Descompón cada número en factores primos.<br/>
        <!-- HTML -->

        <div class="two-operations">
      <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">240</span>
            <span class="mcm-left-number">120</span>
            <span class="mcm-left-number">60</span>
            <span class="mcm-left-number">30</span>
            <span class="mcm-left-number">15</span>
            <span class="mcm-left-number">5</span>
            <!-- Último número en verde -->
            <span class="mcm-left-number mcm-final">1</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">3</span>
            <span class="mcm-factor">5</span>
          </div>
        </div>
      </div>

      <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">300</span>
            <span class="mcm-left-number">150</span>
            <span class="mcm-left-number">75</span>
            <span class="mcm-left-number">25</span>
            <span class="mcm-left-number">5</span>
            <!-- Último número en verde -->
            <span class="mcm-left-number mcm-final">1</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">3</span>
            <span class="mcm-factor">5</span>
            <span class="mcm-factor">5</span>
          </div>
        </div>
      </div>


                   </li>
               		 <li>Toma los <strong>factores comunes con menor exponente</strong>.<br/>


      <!-- HTML -->
      <div class="operation-vertical">

      <span style="color: var(--clr-top)">
       240</span> =
        <span style="color: var(--clr-bottom)">
             <span class="number">2<sup>4</sup></span> ×   <span class="hand-circle">3</span> ×
          <span class="hand-circle">5</span>
        </span>
      </div>

      <div class="operation-vertical">
        <span style="color: var(--clr-top)">300</span> =
         <span style="color: var(--clr-bottom)">
           <span class="hand-circle">
          <span class="number">2<sup>2</sup></span>
        </span>
         × 3 ×

          <span class="number">5<sup>2</sup></span>
        </span>
      </div>

      </li>
               		 <li>Multiplica esos factores: el resultado es el m.c.m. <br/>

      <!-- HTML -->
      <div class="operation-vertical">
       <span style="color: var(--clr-bottom)">
       <span class="number">2<sup>2</sup></span> × 3 × 5</span></span> = <span style="color: var(--clr-result)">60</span>
      </div>
      <!-- HTML -->
      <div class="operation-vertical-2">
       <span style="color: var(--clr-step)">m.c.d (240, 300) =</span> <span style="color: var(--clr-result)">60</span>
      </div>



      </li>
               	   </ol>

                            	   <iframe class="iframe" src="https://www.youtube.com/embed/eQMrwst4bko" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>



               `
               },

               /* ----- M U L T I P L I C A C I Ó N   1   C I F R A ----- */
               multiplicacion: {
               label: 'Multiplicación por 1 cifra llevando',
               symbol: '&times;',
               generate: () => [rand(100, 999), rand(2, 9)],
               calc: (a, b) => a * b,
               instructions: `
               <h2><u>Multiplicación por una cifra con llevadas</u></h2>
               <ol>
               <li>
               	  Escribe los <strong>factores</strong> uno debajo del otro, alineados a la derecha.<br>
               <div class="operation">
               <span class="op-line op-top">  543</span>
               <span class="op-line"><span class="op-sign">×</span><span class="op-bottom"> 5</span></span>
               </div>
               </li>

               <li>
               	  <strong>Multiplica la cifra inferior</strong> (<em>5</em>) <strong>por cada una de las cifras del número superior</strong>, comenzando por la derecha.<br>
               	  Si el resultado tiene dos cifras, escribe solo la <em>unidad</em> y lleva la <em>decena</em>.<br>
               	  Por ejemplo: 5 × 3 = 15. Escribimos el <strong>5</strong> y llevamos <strong>1</strong>.
               	  <div class="operation" style="margin-top: 12px;">
               	  <span class="op-line">
               		  <span class="carry" style="--carry-x:-1.9em; --carry-y:-0.9em">1</span>
               	  </span>
               	  <span class="op-line op-top">  543</span>
               	  <span class="op-line"><span class="op-sign">×</span><span class="op-bottom"> 5</span></span>
               	  <hr>
               	  <span class="op-line op-result">5</span>
               	  </div>
               </li>

               <li>
               	  Multiplica la cifra inferior por la <em>decena</em> del número superior y súmale la llevada:<br>
               	  5 × 4 = 20, más 1 = 21. Escribimos el <strong>1</strong> y llevamos <strong>2</strong>.
               <div class="operation" style="margin-top: 12px;">
               <span class="op-line">
               	  <span class="carry" style="--carry-x:-3.4em; --carry-y:-0.9em">2</span>
               	  <span class="carry" style="--carry-x:-1.9em; --carry-y:-0.9em">1</span>
               </span>
               <span class="op-line op-top">  543</span>
               <span class="op-line"><span class="op-sign">×</span><span class="op-bottom"> 5</span></span>
               <hr>
               <span class="op-line op-result">15</span>
               </div>
               </li>

               <li>
               	  Finalmente, multiplica la cifra inferior por la <em>centena</em>: 5 × 5 = 25. Súmale la llevada (<strong>2</strong>), obteniendo <strong>27</strong>.<br>
               	  Como ya no quedan cifras por multiplicar, escribe el <strong>27</strong> completo a la izquierda.
               <div class="operation" style="margin-top: 12px;">
               <span class="op-line">
               	  <span class="carry" style="--carry-x:-3.4em; --carry-y:-0.9em">2</span>
               	  <span class="carry" style="--carry-x:-1.9em; --carry-y:-0.9em">1</span>
               </span>
               <span class="op-line op-top">  543</span>
               <span class="op-line"><span class="op-sign">×</span><span class="op-bottom"> 5</span></span>
               <hr>
               <span class="op-line op-result">2715</span>
               </div>
               </li>

               <iframe class="iframe" src="https://www.youtube.com/embed/_qaPe8preOg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

               </ol>
               `
               },


      /* -------- PRIMOS Y COMPUESTOS -------- */
      primos_compuestos: {
        label: '', symbol: '',
        generate: () => [rand(10, 50)],
        calc: (n) => {
          const isPrime = (n) => {
            if (n < 2) return false;
            for (let i = 2; i <= Math.sqrt(n); i++) {
              if (n % i === 0) return false;
            }
            return true;
          };
          return isPrime(n) ? 1 : 2;
        },
        instructions: `

            <style>
          #instruction {
          padding: 1rem 1.25rem 0rem 1.25rem !important;
          margin-bottom: 0;
              }

          #exercise {
          padding: 0 1.25rem 1rem 1.25rem
      }
          </style>


        <h2>Números primos y números compuestos</h2>
            <p>
            Un <strong>número primo</strong> solo se puede dividir entre 1 y él mismo.<br>
            Un <strong>número compuesto</strong> tiene más de dos divisores.
          </p>


        <style>
        table { border-collapse: collapse; margin: 1rem 0; }
        td    { width: 32px; height: 32px; text-align: center; border: 1px solid #ccc; }
        .prime { background:#b3e5fc; color:#0d47a1; font-weight:bold; }
          /* —— tabla de primos —— */
        .tabla-primos           { border-collapse: collapse; margin-top: .5rem; }
        .tabla-primos td,
        .tabla-primos th        { width: 32px; height: 32px; text-align: center; border: 1px solid #ccc; }
        .tabla-primos .prime    { background:#b3e5fc; color:#0d47a1; font-weight:bold; }
      </style>


      <button id="togglePrimosBtn" class="btn" onclick="togglePrimos()">Ver más</button>

      <div id="tablaPrimos100" style="display:none;">

        <h3>Tabla de números primos del 1 al 100</h3>
      <p>En azul, los números que son primos del 1 al 100</p>

        <table class="tabla-primos">
          <tbody>
            <tr><td>1</td><td class="prime">2</td><td class="prime">3</td><td>4</td><td class="prime">5</td><td>6</td><td class="prime">7</td><td>8</td><td>9</td><td>10</td></tr>
            <tr><td class="prime">11</td><td>12</td><td class="prime">13</td><td>14</td><td>15</td><td>16</td><td class="prime">17</td><td>18</td><td class="prime">19</td><td>20</td></tr>
            <tr><td>21</td><td>22</td><td class="prime">23</td><td>24</td><td>25</td><td>26</td><td>27</td><td>28</td><td class="prime">29</td><td>30</td></tr>
            <tr><td class="prime">31</td><td>32</td><td>33</td><td>34</td><td>35</td><td>36</td><td class="prime">37</td><td>38</td><td>39</td><td>40</td></tr>
            <tr><td class="prime">41</td><td>42</td><td class="prime">43</td><td>44</td><td>45</td><td>46</td><td class="prime">47</td><td>48</td><td>49</td><td>50</td></tr>
            <tr><td>51</td><td>52</td><td class="prime">53</td><td>54</td><td>55</td><td>56</td><td>57</td><td>58</td><td class="prime">59</td><td>60</td></tr>
            <tr><td class="prime">61</td><td>62</td><td>63</td><td>64</td><td>65</td><td>66</td><td class="prime">67</td><td>68</td><td>69</td><td>70</td></tr>
            <tr><td class="prime">71</td><td>72</td><td class="prime">73</td><td>74</td><td>75</td><td>76</td><td>77</td><td>78</td><td class="prime">79</td><td>80</td></tr>
            <tr><td>81</td><td>82</td><td class="prime">83</td><td>84</td><td>85</td><td>86</td><td>87</td><td>88</td><td class="prime">89</td><td>90</td></tr>
            <tr><td>91</td><td>92</td><td>93</td><td>94</td><td>95</td><td>96</td><td class="prime">97</td><td>98</td><td>99</td><td>100</td></tr>
          </tbody>
        </table>
      </div>

      <br/>

              <iframe class="iframe" src="https://www.youtube.com/embed/unTZrtgnesg" title="Video: Factores primos" frameborder="0" allowfullscreen></iframe>
        <hr/>
          <h2>¿Primo o compuesto?</h2>
          <p>
            Escribe <strong>1</strong> si crees que el número es <strong>primo</strong>.<br>
            Escribe <strong>2</strong> si crees que el número es <strong>compuesto</strong>.
          </p>
        `
      },


      /* ---- FACTORES PRIMOS ---- */
      descomposicionPrimos: {
        label: '',
        symbol: '÷',
        generate: () => {
          // Generamos un número compuesto para que tenga descomposición interesante
          const primes = [2, 3, 5, 7];
          let num = 1;
          const count = rand(2, 4); // 2 a 4 factores primos
          for (let i = 0; i < count; i++) {
            num *= primes[rand(0, primes.length - 1)];
          }
          return [num];
        },
        calc: (n) => {
          const factors = [];
          let divisor = 2;
          while (n > 1) {
            while (n % divisor === 0) {
              factors.push(divisor);
              n = n / divisor;
            }
            divisor++;
          }
          return factors.join(' × ');
        },
        instructions: `


            <style>
          #instruction {
          padding: 1rem 1.25rem 0rem 1.25rem !important;
          margin-bottom: 0;
              }

          #exercise {
          padding: 0 1.25rem 1rem 1.25rem
      }
          </style>


          <h2>Descomposición en factores primos</h2>
          <p>Consiste en expresar un número como el producto de sus <strong>factores primos</strong>.</p>

          <h3>Pasos:</h3>
          <ol>
      <li>Comienza dividiendo el número entre el menor número primo, que es <strong>2</strong>. Siempre se empieza por el 2. Si el número no es divisible entre 2, se prueba con el siguiente número primo (3, 5, 7, etc.). En nuestro ejemplo, el número 36 sí es divisible entre 2, por lo que escribimos el número primo a la derecha, realizamos la división y escribimos el resultado debajo del número original, a la izquierda.
      <br/>
      <!-- HTML -->
      <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">36</span>
            <span class="mcm-left-number">18</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">2</span>
          </div>
        </div>
      </div>



            </li>
      <li>Divide el nuevo resultado por el mismo número primo si todavía es divisible. En nuestro ejemplo, 18 también es divisible entre 2, así que repetimos el procedimiento.<br/>

            <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">36</span>
            <span class="mcm-left-number">18</span>
            <span class="mcm-left-number">9</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">2</span>
          </div>
        </div>
      </div>


      </li>


      <li>Si ya no puedes dividir entre el mismo número primo, pasa al siguiente en orden (3, 5, 7, etc.) hasta encontrar uno que divida exactamente. En nuestro caso, 9 no se puede dividir entre 2, pero sí entre <strong>3</strong>.
      <br/>
      <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">36</span>
            <span class="mcm-left-number">18</span>
            <span class="mcm-left-number">9</span>
            <span class="mcm-left-number">3</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">3</span>
          </div>
        </div>
      </div>

      </li>

      <li>Repite el proceso hasta que el resultado final sea <strong>1</strong>. Esto indica que has terminado la descomposición en factores primos.<br/>

        <!-- HTML -->
      <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">36</span>
            <span class="mcm-left-number">18</span>
            <span class="mcm-left-number">9</span>
            <span class="mcm-left-number">3</span>
            <!-- Último número en verde -->
            <span class="mcm-left-number mcm-final">1</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">3</span>
            <span class="mcm-factor">3</span>
          </div>
        </div>
      </div>

      </li>
          </ol>

          <p><strong>Resultado:</strong> Ahora sabemos que 36 = 2 × 2 × 3</p>

              <iframe class="iframe" src="https://www.youtube.com/embed/-UC6Pl47gEI" title="Video: Factores primos" frameborder="0" allowfullscreen></iframe>


          <hr/>
          <h3>Ejercicio:</h3>
          <p>Descompón el número en factores primos.</p>
        `
      },



      potencias: {
        label: 'Potencias',
        symbol: '^',
        generate: () => {
          const base = rand(2, 9);
          const exponente = rand(2, 4);
          return [base, exponente];
        },
        calc: (base, exponente) => Math.pow(base, exponente),
      instructions: `
        <h2>Potencias</h2>
        <p>Una potencia representa una multiplicación de un número por sí mismo varias veces.</p>
        <ol>
          <li>La expresión <span style="font-size: 1.5em;" class="number">a<sup>n</sup></span> significa multiplicar <strong>a</strong> por sí mismo <strong>n</strong> veces.</li>
          <p>Ejemplo:   </p>

          <div class="operation-vertical">
       <span style="color: var(--clr-top)">
      <span class="number">
      4<sup>2</sup>
      </span>
      </span>
       =  <span style="color: var(--clr-bottom)">4 × 4</span> = <span style="color: var(--clr-result)">16</span>
      </div>


              <p>Otro ejemplo:   </p>

          <div class="operation-vertical">
       <span style="color: var(--clr-top)">
      <span class="number">
      2<sup>3</sup>
      </span>
      </span>
       =  <span style="color: var(--clr-bottom)">2 × 2 × 2</span> = <span style="color: var(--clr-result)">8</span>
      </div>

        </ol>


        <iframe class="iframe" src="https://www.youtube.com/embed/6F0y3BkitW0" title="Potencias" frameborder="0" allowfullscreen></iframe>
      `

      },

      /* ────── O P E R A C I Ó N · O P E R A C I O N E S  C O M B I N A D A S ────── */
      operacionesCombinadas: {
        label: 'Operaciones combinadas',
        symbol: '()',

        generate: () => {
          const visOps = ['+', '−', '×', '÷'];
          const randNum = () => rand(1, 15);
          const pick    = arr => arr[rand(0, arr.length - 1)];

          /* ───── helpers ───── */
          const simple = () => {
            // 50 % de probabilidad de que sea potencia
            if (Math.random() < 0.5) {
              const base = randNum();
              const exp  = rand(2, 4);              // exponente pequeño
              return `${base} ^ ${exp}`;            // versión eval
            }
            return `${randNum()} ${pick(visOps)} ${randNum()}`;
          };

          const wrap = (str, kind) =>
            kind === '()' ? `(${str})` :
            kind === '[]' ? `[${str}]` :
            kind === '{}' ? `{${str}}` : str;

          /* ───── construcción de 2-3 niveles ───── */
          let expr = `${wrap(simple(), '()')} ${pick(visOps)} ${wrap(simple(), Math.random() < 0.5 ? '[]' : '{}')}`;
          if (Math.random() < 0.5) {
            expr = `${wrap(expr, Math.random() < 0.5 ? '{}' : '[]')} ${pick(visOps)} ${randNum()}`;
          }

          /* ───── exprPretty y exprEval ───── */
          const exprPretty = expr.replace(/\^ (\d+)/g, '<sup>$1</sup>'); // potencias bonitas

          const exprEval = expr
            .replace(/−/g, '-')         // menos unicode → ASCII
            .replace(/×/g, '*')
            .replace(/÷/g, '/')
            .replace(/\^/g, '**')       // potencia JS
            .replace(/[{\[]/g, '(')
            .replace(/[}\]]/g, ')')
            .replace(/\s+/g, ' ')
            .trim();

          return [exprPretty, exprEval];
        },

        calc: (exprPretty, exprEval) => {
          try { return eval(exprEval); }
          catch { return NaN; }
        },

      instructions: `
        <h2>Operaciones combinadas</h2>
        <p><strong>Una operación combinada</strong> es aquella en la que conviven diferentes tipos de operaciones, salvo que éstas sean exclusivamente sumas y restas.</p>

        <div class="operation-vertical">
          <span style="color: var(--clr-top)">
            (<strong>11 ÷ 3</strong>) × <strong>{5 − 14}</strong>
          </span> =
          <span style="color: var(--clr-result)">
            <strong>−33</strong>
          </span>
        </div>

        <p>Para realizar correctamente cualquier operación combinada, es imprescindible conocer las <u>reglas de prioridad</u> que nos informan sobre qué operación debe llevarse a cabo en primer lugar:</p>
        <ol>
          <li><strong>Corchetes</strong></li>
          <li><strong>Paréntesis</strong></li>
          <li><strong>Potencias y raíces</strong></li>
          <li><strong>Multiplicaciones y divisiones</strong></li>
          <li><strong>Sumas y restas</strong></li>
        </ol>

        <p><em>Se recomienda</em>, además, hacer muy pocas operaciones en cada paso y <strong>escribir los elementos que no se han empleado todavía en el lugar que ocupan en la operación original</strong>.</p>

        <p><u>Debemos tener en cuenta</u> que, cuando realizamos un paréntesis o un corchete, debemos <strong>establecer la prioridad dentro del mismo</strong>.</p>

        <iframe class="iframe" src="https://www.youtube.com/embed/CB7CWWiaUbA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
      `

      },


               /* ---------------- S U M A ---------------- */
               suma: {
               label: 'Suma', symbol: '+',
               generate: () => {
               	  const roll = rand(1, 30);               // 1-30   (LCM 5 & 6)

               	  // 1 de cada 5 → ambos de tres cifras
               	  if (roll % 5 === 0) {
               		  return [rand(100, 999), rand(100, 999)];
               	  }

               	  // 1 de cada 6 → un número de dos cifras y otro de tres
               	  if (roll % 6 === 0) {
               		  return Math.random() < 0.5
               			  ? [rand(10, 99), rand(100, 999)]   // 2c + 3c
               			  : [rand(100, 999), rand(10, 99)];   // 3c + 2c
               	  }

               	  // Caso normal → ambos de dos cifras
               	  return [rand(10, 99), rand(10, 99)];
               },
               calc: (a, b) => a + b,
               instructions: `
               		 <h2>Suma llevando</h2>
               		 <ol>
               		   <li>
               			 Alinea los <strong>sumandos</strong> en columnas: unidades debajo de unidades, decenas debajo de decenas, etc.<br>
               			 <div class="operation">
               			   <span class="op-line"></span>
               			   <span class="op-line op-top">  25</span>
               			   <span class="op-line"><span class="op-sign">+</span><span class="op-bottom"> 16</span></span>
               			 </div>
               		   </li>
               		   <li>
               			 Suma las <strong>unidades</strong>. Si el resultado es mayor que 9, escribe solo la cifra de las unidades y <em>lleva</em> la decena a la siguiente columna (la de las decenas). Esto se llama <em>llevada</em>. <br>
               			 En el ejemplo, 5 + 6 = 11. Escribimos el 1 (de las unidades) y llevamos 1 (de las decenas).<br>
               			 <div class="operation" style="margin-top: 12px;">
               			   <span class="op-line">
               				 <span class="carry" style="--carry-x:-2em; --carry-y:-0.9em">1</span>
               			   </span>
               			   <span class="op-line op-top">  25</span>
               			   <span class="op-line"><span class="op-sign">+</span><span class="op-bottom"> 16</span></span>
               			   <hr>
               			   <span class="op-line op-result">1</span>
               			 </div>
               		   </li>
               		   <li>
               			 Suma la columna de las <strong>decenas</strong>, incluyendo la llevada si la hay. En este ejemplo, 2 + 1 = 3, y sumamos la llevada (1), lo que da 4. Por tanto, el resultado final es 41.<br>
               			 <div class="operation" style="margin-top: 12px;">
               			   <span class="op-line">
               				 <span class="carry" style="--carry-x:-2em; --carry-y:-0.9em">1</span>
               			   </span>
               			   <span class="op-line op-top">  25</span>
               			   <span class="op-line"><span class="op-sign">+</span><span class="op-bottom"> 16</span></span>
               			   <hr>
               			   <span class="op-line op-result">  41</span>
               			 </div>
               		   </li>
               		 </ol>

               	   <iframe class="iframe" src="https://www.youtube.com/embed/X5Rc04AKHVc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

               		 ` },

               /* ---------------- S U M A  D E   E N T E R O S ---------------- */
               sumaEnteros: {
               label: 'Suma y resta de números enteros',
               // El símbolo genérico ya no hace falta porque el enunciado se genera a mano
               // Genera los dos operandos y el signo de la OPERACIÓN (no del número)
               generate: () => {
               const a = rand(-99, 99);
               let b = rand(-99, 99);
               while (b === 0) b = rand(-99, 99);          // evita segundo operando nulo

               const op = Math.random() < 0.5 ? '+' : '-'; // '+' → suma · '−' → resta

               // evita resultados nulos (opcional)
               if ((op === '+' && a === -b) || (op === '-' && a ===  b)) {
               return sumaEnteros.generate();             // reintenta si da 0
               }
               return [a, b, op];                           // <─ ¡DEVUELVE también op!
               },

               // ✅ Cálculo correcto según el signo de la operación
               calc: (a, b, op) => (op === '+') ? a + b : a - b,


               instructions: `
               <h2>Suma y resta de números enteros</h2>

               <p>Una manera rigurosa y clara de representar la <strong>suma</strong> o la <strong>resta</strong> de dos números enteros es usando <strong>paréntesis</strong>. Estos cumplen dos funciones esenciales:</p>
               <ul>
               <li><em>Vinculan</em> cada número con su signo.</li>
               <li><em>Evitan</em> que el signo de la operación y el del segundo sumando queden “pegados”.</li>
               </ul>

               <ol>
               <li><strong><u>Eliminar el primer paréntesis</u></strong></li>
               <p><em>Simplemente se retira:</em></p>

               <div class="two-divisions">
               <div class="operation">
               <span class="op-line op-top"><strong>(+5)</strong></span>
               <span class="op-line"><span class="op-sign"><strong>-</strong></span><span class="op-bottom"><strong>(+6)</strong></span></span>
               <hr>
               </div>
               			<span class="center-arrow" style="margin: auto 3em !important;">
               				<svg class="normal-arrow-divisions" version="1.0" xmlns="http://www.w3.org/2000/svg" width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000" preserveAspectRatio="xMidYMid meet">
               				<metadata>
               				Created by potrace 1.15, written by Peter Selinger 2001-2017
               				</metadata>
               				<g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)" stroke="none">
               				<path d="M8590 5015 c0 -3 7 -19 15 -36 34 -65 185 -442 228 -569 92 -273 172
               				-639 179 -827 l3 -63 -4508 0 -4507 0 0 -315 0 -315 4511 0 4511 0 -6 -67
               				c-10 -99 -53 -352 -81 -473 -49 -219 -128 -447 -268 -780 -41 -96 -73 -176
               				-72 -177 4 -6 348 140 1915 815 784 338 2102 911 2223 967 32 15 55 31 50 35
               				-4 4 -55 28 -113 53 -58 25 -199 86 -315 137 -244 107 -485 212 -1572 681
               				-692 299 -1791 769 -2160 926 -18 7 -33 11 -33 8z"></path>
               				</g>
               				</svg>
               			</span>
               <div class="operation">
               <span class="op-line op-top"><strong>+5&nbsp;</strong></span>
               <span class="op-line"><span class="op-sign"><strong>-</strong></span><span class="op-bottom"><strong>(+6)</strong></span></span>
               <hr>
               </div>
               </div>

               <li><strong><u>Eliminar el segundo paréntesis</u></strong></li>
               <p>Para quitar el paréntesis del segundo sumando, hemos de <em>fusionar</em> el signo de la operación con el del sumando. Es decir, convertimos el signo intermedio en un solo signo siguiendo esta regla:</p>
               <ul>
               <li><strong>Si el signo intermedio y el siguiente signo son iguales</strong> (por ejemplo, <code>+ +</code> o <code>- -</code>), se sustituyen por un único <strong><code>+</code></strong>.</li>
               <li><strong>Si los signos son diferentes</strong> (por ejemplo, <code>+ -</code> o <code>- +</code>), se sustituyen por un único <strong><code>-</code></strong>.</li>
               </ul>

               <div class="two-divisions">
               <div class="operation">
               <span class="op-line op-top"><strong>+5&nbsp;</strong></span>
               <span class="op-line"><span class="op-sign"><strong>-</strong></span><span class="op-bottom"><strong>(+6)</strong></span></span>
               <hr>
               </div>
               			<span class="center-arrow" style="margin: auto 3em !important;">
               				<svg class="normal-arrow-divisions" version="1.0" xmlns="http://www.w3.org/2000/svg" width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000" preserveAspectRatio="xMidYMid meet">
               				<metadata>
               				Created by potrace 1.15, written by Peter Selinger 2001-2017
               				</metadata>
               				<g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)" stroke="none">
               				<path d="M8590 5015 c0 -3 7 -19 15 -36 34 -65 185 -442 228 -569 92 -273 172
               				-639 179 -827 l3 -63 -4508 0 -4507 0 0 -315 0 -315 4511 0 4511 0 -6 -67
               				c-10 -99 -53 -352 -81 -473 -49 -219 -128 -447 -268 -780 -41 -96 -73 -176
               				-72 -177 4 -6 348 140 1915 815 784 338 2102 911 2223 967 32 15 55 31 50 35
               				-4 4 -55 28 -113 53 -58 25 -199 86 -315 137 -244 107 -485 212 -1572 681
               				-692 299 -1791 769 -2160 926 -18 7 -33 11 -33 8z"></path>
               				</g>
               				</svg>
               			</span>
               <div class="operation">
               <span class="op-line op-top"><strong>+5</strong></span>
               <span class="op-line">&nbsp;<span class="op-sign"><strong>-</strong></span><span class="op-bottom"><strong>6</strong></span></span>
               <hr>
               </div>
               </div>

               <li><strong><u>Operación final</u></strong></li>
               <p>Una vez eliminados los paréntesis, pasamos a obtener el <strong>valor final</strong>. Para ello, observamos los signos que nos han quedado:</p>
               <ul>
               <li>Si <strong>ambos signos son iguales</strong>, se <u>suman</u> los valores absolutos de los sumandos y al resultado se le asigna el <strong>mismo signo</strong>.</li>
               <li>Si los signos son <strong>diferentes</strong>, se <u>resta</u> el valor absoluto mayor menos el menor y se asigna al resultado el <strong>signo del número con mayor valor absoluto</strong>.</li>
               </ul>

               </ol>


               <h3><strong><u>Ejemplos</u></strong></h3>

               <h4><strong>Ejemplo 1:</strong> <em>(-3) + (-4)</em></h4>
               <div class="operation">
               <span class="op-line op-top">(-3)</span>
               <span class="op-line"><span class="op-sign">+</span><span class="op-bottom"> (-4)</span></span>
               <hr>
               <span class="op-line op-result"><strong>-7&nbsp;</strong></span>
               </div>

               <h4><strong>Ejemplo 2:</strong> <em>(+7) + (-2)</em></h4>
               <div class="operation">
               <span class="op-line op-top">(+7)</span>
               <span class="op-line"><span class="op-sign">+</span><span class="op-bottom"> (-2)</span></span>
               <hr>
               <span class="op-line op-result"><strong>+5&nbsp;</strong></span>
               </div>


               	<iframe class="iframe" src="https://www.youtube.com/embed/yNpOcHv9Wz4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>


               `
               },


               sumaDecimales: {
               label: 'Suma con decimales', symbol: '+',
               generate: () => [+(Math.random() * 90 + 10).toFixed(1), +(Math.random() * 90 + 10).toFixed(2)],
               calc: (a, b) => +(a + b).toFixed(3),
               instructions: `
               	<h2>Suma de números decimales</h2>
               	<ol>
               	<li><strong>Alinea los números por la coma decimal</strong>, agregando ceros a la izquierda, si es necesario, para igualar las cifras decimales.<br>
               			 <div class="operation">
               			   <span class="op-line op-top">  12,5</span>
               			   <span class="op-line"><span class="op-sign">+</span><span class="op-bottom">&nbsp;7,35</span></span>
               			 </div>
               	</li>
               	<li><strong>Suma de derecha a izquierda</strong>, columna por columna. Coloca la coma decimal del resultado alineada con las demás.<br>
               			 <div class="operation">
               			   <span class="op-line op-top">  12,50</span>
               			   <span class="op-line"><span class="op-sign">+</span><span class="op-bottom">&nbsp;7,35</span></span>
               			   <hr>
               			   <span class="op-line op-result">  19,85</span>
               			 </div>
               	</li>

               	<iframe class="iframe" src="https://www.youtube.com/embed/0NNshc96lDY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

               	</ol>`
               },

               /* -------- S U M A  F R A C C I O N E S -------- */
               sumaFracciones: {
               label: 'Suma de fracciones', symbol: '+',
               generate: () => {
               	  const d1 = rand(2, 9), d2 = rand(2, 9);
               	  return [frac(rand(1, d1 - 1), d1), frac(rand(1, d2 - 1), d2)];
               },
               calc: (a, b) => {
               	  const f1 = parseFrac(a), f2 = parseFrac(b);
               	  const m = lcm(f1.d, f2.d);
               	  const n = f1.n * (m / f1.d) + f2.n * (m / f2.d);
               	  return n / m;
               },
               instructions: `
               		 <h2>Suma de fracciones</h2>
                   <p>A continuación, veremos como resolver sumas de fracciones, con mismo y distinto denominador.</p>
                   <h3><u>Suma de fracciones con mismo denominador</u></h3>
               		 <ol>
               		   <li>Si el denominador (número de abajo) es igual en ambas fracciones, sumamos ambos numeradores (números superiores), dejamos el denominador igual y representamos los resultados en forma de fracción.<br>
               <div class="operation" style="display: inline-block">
               	 <span class="frac"><span class="top">3</span><span class="bottom">5</span></span>
               	 <span class="op-sign">+</span>
               	 <span class="frac"><span class="top">1</span><span class="bottom">5</span></span>
               	 <span class="equal">=</span>
               	 <span class="result"><span class="frac"><span class="top">4</span><span class="bottom">5</span></span></span>
               </div>
               		   </li>
                     </ol>


                   <h3><u>Suma de fracciones con distinto denominador</u></h3>
               		 <ol>

                   <li>Pongamos el ejemplo de que tenemos esta <strong>suma de fracciones con distinto denominador</strong>: <br/>

                            <div class="operation" style="display: inline-block">
               	 <span class="frac"><span class="top">1</span><span class="bottom">4</span></span>
               	 <span class="op-sign">+</span>
               	 <span class="frac"><span class="top">2</span><span class="bottom">3</span></span>
               	</span>
               </div>
               </li>
               		   <li>Extrae el <strong>mínimo común múltiplo</strong> de amnbos denominadores.<br>

               <div class="two-operations">
      <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">4</span>
            <span class="mcm-left-number">2</span>
            <!-- Último número en verde -->
            <span class="mcm-left-number mcm-final">1</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">2</span>
          </div>
        </div>
      </div>

      <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">3</span>
            <span class="mcm-left-number mcm-final">1</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">3</span>
          </div>
        </div>
      </div>
      </div>

      <br/>

      <div class="operation-vertical">
       <span style="color: var(--clr-bottom)">
      <span class="number">2<sup>2</sup></span> × 3</span> = <span style="color: var(--clr-result)">12</span>
      </div>

               		   </li>



        <li>Coloca los denominadores en su lugar y luego <strong>multiplica cada numerador por el número necesario para que el denominador llegue al mínimo común múltiplo (m.c.m.)</strong>. Por ejemplo: si uno de los denominadores es 4, para convertirlo en 12 (que es el m.c.m. entre 4 y 3), debes multiplicarlo por 3. Del otro lado, si el denominador es 3, multiplícalo por 4 para llegar a 12. <strong>Es muy importante mantener la equivalencia de las fracciones, por lo que debes multiplicar tanto el numerador como el denominador por el mismo número</strong>.<br/>        <div class="operation" style="display: inline-block">
               	 <div class="center">
                 <span class="frac"><span class="top">1</span><span class="bottom">4</span></span>
               	 <span class="op-sign">+</span>
               	 <span class="frac"><span class="top">2</span><span class="bottom">3</span></span>

               	     <span class="center-arrow width-arrow">
               				<svg class="normal-arrow-divisions" version="1.0" xmlns="http://www.w3.org/2000/svg" width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000" preserveAspectRatio="xMidYMid meet">
               				<metadata>
               				Created by potrace 1.15, written by Peter Selinger 2001-2017
               				</metadata>
               				<g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)" stroke="none">
               				<path d="M8590 5015 c0 -3 7 -19 15 -36 34 -65 185 -442 228 -569 92 -273 172
               				-639 179 -827 l3 -63 -4508 0 -4507 0 0 -315 0 -315 4511 0 4511 0 -6 -67
               				c-10 -99 -53 -352 -81 -473 -49 -219 -128 -447 -268 -780 -41 -96 -73 -176
               				-72 -177 4 -6 348 140 1915 815 784 338 2102 911 2223 967 32 15 55 31 50 35
               				-4 4 -55 28 -113 53 -58 25 -199 86 -315 137 -244 107 -485 212 -1572 681
               				-692 299 -1791 769 -2160 926 -18 7 -33 11 -33 8z"></path>
               				</g>
               				</svg>
               			</span>
               	 <span class="result"><span class="frac">
                  <span class="frac"><span class="top">1 × 3</span><span class="bottom">4 × 3</span></span>
               	  <span class="op-sign signo-center">+</span>
               	  <span class="frac"><span class="top">2 × 4</span><span class="bottom">3 × 4</span></span>
               	 </span></span>
               </div>
               </div>
               		   </li>




                <li>Realiza la <strong>multiplicación</strong> y coloca los resultados en forma de fracciones.<br>
               <div class="operation" style="display: inline-block">
               	 <span class="frac">
                 <span class="top">1</span>
                 <span class="bottom">4</span></span>

               	 <span class="op-sign">+</span>

               	 <span class="frac">
                 <span class="top">2</span>
                 <span class="bottom">3</span></span>

               	 <span class="equal">=</span>
               	 <span class="result">
                 <span class="frac">
                 <span class="top">3</span>
                 <span class="bottom">12</span></span>

               	 <span class="op-sign">+</span>

               	 <span class="frac">
                 <span class="top">4</span>
                 <span class="bottom">12</span>
                 </span></span>
               </div>
               		   </li>



                                             		   <li>Realiza la <strong>suma de los numeradores</strong>.<br>
               <div class="operation" style="display: inline-block">
               	 <span class="frac">
                 <span class="top">3</span>
                 <span class="bottom">12</span></span>

               	 <span class="op-sign">+</span>

               	 <span class="frac">
                 <span class="top">4</span>
                 <span class="bottom">12</span></span>

               	 <span class="equal">=</span>
               	 <span class="result">
                 <span class="frac">
                 <span class="top">7</span>
                 <span class="bottom">12</span></span>
                 </span></span>
               </div>
               		   </li>

               		 </ol>

                                <iframe class="iframe" src="https://www.youtube.com/embed/rSLuXOTdje8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>


                                  `
               },

               /* ---------------- R E S T A ---------------- */
               resta: {
               label: 'Resta', symbol: '&#8722;',
               generate: () => {
               	  const roll = rand(1, 30);               // 1-30

               	  // 1 de cada 5 → ambos de tres cifras
               	  if (roll % 5 === 0) {
               		  const minuendo = rand(100, 999);
               		  const sustraendo = rand(100, minuendo - 1); // evita negativo
               		  return [minuendo, sustraendo];
               	  }

               	  // 1 de cada 6 → minuendo de tres cifras, sustraendo de dos
               	  if (roll % 6 === 0) {
               		  const minuendo = rand(100, 999);    // 3 cifras
               		  const sustraendo = rand(10, 99);      // 2 cifras (seguro menor)
               		  return [minuendo, sustraendo];
               	  }

               	  // Caso normal → ambos de dos cifras
               	  const minuendo = rand(30, 99);
               	  const sustraendo = rand(10, minuendo - 1);
               	  return [minuendo, sustraendo];
               },
               calc: (a, b) => a - b,
               instructions: `
               	   <h2>Resta llevando</h2>
               	   <ol>
               		 <li>
               		   Coloca el <strong>minuendo</strong> (el número mayor) arriba y el <strong>sustraendo</strong> (el menor) abajo. Alinea bien las unidades y decenas:
               		   <div class="operation">
               			 <span class="op-line op-top">  35</span>
               			 <span class="op-line"><span class="op-sign">-</span><span class="op-bottom"> 18</span></span>
               		   </div>
               		 </li>

               		 <li>
               		   Empieza por las <strong>unidades</strong> (la columna de la derecha). Si el dígito de arriba es menor que el de abajo, necesitas <strong>pedir prestado</strong>:
               		   <ul>
               			 <li>En el ejemplo: 5 - 8 no se puede, porque 5 es menor.</li>
               			 <li>Pedimos 1 decena al 3 (decenas), después de prestar, el 3 quedó en 2.</li>
               			 <li>Esa decena se convierte en 10 unidades: 10 + 5 = 15.</li>
               			 <li>Ahora sí podemos restar: 15 - 8 = 7.</li>
               		   </ul>

               <div class="operation">
               	 <span class="op-line op-top">
               	   <!-- Decena: tachado y reemplazo -->
               	   <span class="op-digit">
               		 <span class="strike">3</span>
               		 <span class="borrowed">2</span>
               	   </span>

               	   <!-- Unidad: muestra 5 con carry flotando a su izquierda -->
               	   <span class="op-digit" style="position: relative;">
               		 <span class="carry" style="--carry-x: -0.54em;--carry-y: 0.75em;">1</span>
               		 5
               	   </span>
               	 </span>

               	 <span class="op-line">
               	   <span class="op-sign">-</span>
               	   <span class="op-bottom">
               		 <span class="op-digit">1</span>
               		 <span class="op-digit">8</span>
               	   </span>
               	 </span>

               	 <hr>

               	 <span class="op-line op-result">
               	   <span class="op-digit">7</span>
               	 </span>
               </div>


               		 </li>

               		 <li>
               		   Ahora resta las <strong>decenas</strong>:
               		   <ul>
               			 <li>Después de prestar, el 3 quedó en 2.</li>
               			 <li>Entonces: 2 - 1 = 1. Lo colocamos y da como resultado 17.</li>
               		   </ul>
               <div class="operation">
               	 <span class="op-line op-top">
               	   <!-- Decena: tachado y reemplazo -->
               	   <span class="op-digit">
               		 <span class="strike">3</span>
               		 <span class="borrowed">2</span>
               	   </span>

               	   <!-- Unidad: muestra 5 con carry flotando a su izquierda -->
               	   <span class="op-digit" style="position: relative;">
               		 <span class="carry" style="--carry-x: -0.54em;--carry-y: 0.75em;">1</span>
               		 5
               	   </span>
               	 </span>

               	 <span class="op-line">
               	   <span class="op-sign">-</span>
               	   <span class="op-bottom">
               		 <span class="op-digit">1</span>
               		 <span class="op-digit">8</span>
               	   </span>
               	 </span>

               	 <hr>

               	 <span class="op-line op-result">
               	   <span class="op-digit">1</span>
               	   <span class="op-digit">7</span>
               	 </span>
               </div>

               		 </li>
               	   </ol>

               <iframe class="iframe" src="https://www.youtube.com/embed/pRTII2H5EDg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

               <hr>

               	   <h3>Extra: ¿Qué pasa si hay un cero pero se puede pedir número?</h3>
               <p>Imagina que estás haciendo una resta: <strong>203 - 178</strong>. Parece que todo está bien, pero ¡ups! Hay un <strong>0</strong> en el medio. ¿Qué hacemos si no podemos restar directamente?</p>
               <p>Vamos paso a paso como si fuera una historia:</p>
               <ol>
               	 <li><strong>Paso 1:</strong> Queremos restar 3 - 8, pero 3 es más pequeño que 8, así que necesita ayuda.</li>
               	 <li><strong>Paso 2:</strong> El 3 le pide ayuda al número de al lado, que es 0... pero el 0 está vacío y no tiene nada para prestar.</li>

               	   <div class="operation">

               			 <div class="flechas">
               	   <!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
               	   <svg class="curved-arrow" style="transform: scaleX(-1);" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
               		 viewBox="0 0 302.816 302.816" xml:space="preserve">
               	   <path id="XMLID_6_" d="M298.423,152.996c-5.857-5.858-15.354-5.858-21.213,0l-35.137,35.136
               		 c-5.871-59.78-50.15-111.403-112.001-123.706c-45.526-9.055-92.479,5.005-125.596,37.612c-5.903,5.813-5.977,15.31-0.165,21.213
               		 c5.813,5.903,15.31,5.977,21.212,0.164c26.029-25.628,62.923-36.679,98.695-29.565c48.865,9.72,83.772,50.677,88.07,97.978
               		 l-38.835-38.835c-5.857-5.857-15.355-5.858-21.213,0.001c-5.858,5.858-5.858,15.355,0,21.213l62.485,62.485
               		 c2.929,2.929,6.768,4.393,10.606,4.393s7.678-1.464,10.607-4.393l62.483-62.482C304.281,168.352,304.281,158.854,298.423,152.996z"
               		 />
               	   </svg>


               	   <svg class="curved-arrow" style="transform: scaleX(-1);" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
               		 viewBox="0 0 302.816 302.816" xml:space="preserve">
               	   <path id="XMLID_6_" d="M298.423,152.996c-5.857-5.858-15.354-5.858-21.213,0l-35.137,35.136
               		 c-5.871-59.78-50.15-111.403-112.001-123.706c-45.526-9.055-92.479,5.005-125.596,37.612c-5.903,5.813-5.977,15.31-0.165,21.213
               		 c5.813,5.903,15.31,5.977,21.212,0.164c26.029-25.628,62.923-36.679,98.695-29.565c48.865,9.72,83.772,50.677,88.07,97.978
               		 l-38.835-38.835c-5.857-5.857-15.355-5.858-21.213,0.001c-5.858,5.858-5.858,15.355,0,21.213l62.485,62.485
               		 c2.929,2.929,6.768,4.393,10.606,4.393s7.678-1.464,10.607-4.393l62.483-62.482C304.281,168.352,304.281,158.854,298.423,152.996z"
               		 />
               	   </svg>

               		   </div>

               		 <span class="op-line op-top">
               		   <!-- Decena: tachado y reemplazo -->
               		   <span class="op-digit">
               		   2
               		   </span>
               			   <span class="op-digit">
               			 0
               		   </span>
               		   <span class="op-digit">
               			 3
               		   </span>
               		 </span>

               		 <span class="op-line">
               		   <span class="op-sign">-</span>
               		   <span class="op-bottom">
               			 <span class="op-digit">1</span>
               			 <span class="op-digit">7</span>
               			 <span class="op-digit">8</span>
               		   </span>
               		 </span>


               	   </div>

               	 <li><strong>Paso 3:</strong> Entonces el 0 le pide ayuda al número de al lado, que es 2. El 2 sí puede ayudar, así que se convierte en 1, y le da un 1 al 0.</li>


               	 <div class="operation">

               	   <span class="op-line op-top" style="margin-top: 12px";>
               		 <!-- Decena: tachado y reemplazo -->
               		 <span class="op-digit">
               		   <span class="strike">2</span>
               		   <span class="borrowed">1</span>
               		 </span>
               			 <span class="op-digit" style="position: relative;">
               		   0
               				 <span class="carry" style="--carry-x: -0.5em;--carry-y: 0.75em;">1</span>
               		 </span>

               		 <!-- Unidad: muestra 5 con carry flotando a su izquierda -->
               		 <span class="op-digit">
               		   3
               		 </span>
               	   </span>

               	   <span class="op-line">
               		 <span class="op-sign">-</span>
               		 <span class="op-bottom">
               		   <span class="op-digit">1</span>
               		   <span class="op-digit">7</span>
               		   <span class="op-digit">8</span>
               		 </span>
               	   </span>

               	   <hr>

               	 </div>

               	   <li><strong>Paso 4:</strong> El 0 ahora tiene un 10. Como es muy generoso, le presta 10 al 3. Ahora el 3 tiene 10 + 3 = 13.</li>




               	   <div class="operation">

               			 <div class="flechas" style="margin-bottom: 0px; margin-right: 0.6em;">

               	   <!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
               	   <svg class="curved-arrow" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
               		 viewBox="0 0 302.816 302.816" xml:space="preserve">
               	   <path id="XMLID_6_" d="M298.423,152.996c-5.857-5.858-15.354-5.858-21.213,0l-35.137,35.136
               		 c-5.871-59.78-50.15-111.403-112.001-123.706c-45.526-9.055-92.479,5.005-125.596,37.612c-5.903,5.813-5.977,15.31-0.165,21.213
               		 c5.813,5.903,15.31,5.977,21.212,0.164c26.029-25.628,62.923-36.679,98.695-29.565c48.865,9.72,83.772,50.677,88.07,97.978
               		 l-38.835-38.835c-5.857-5.857-15.355-5.858-21.213,0.001c-5.858,5.858-5.858,15.355,0,21.213l62.485,62.485
               		 c2.929,2.929,6.768,4.393,10.606,4.393s7.678-1.464,10.607-4.393l62.483-62.482C304.281,168.352,304.281,158.854,298.423,152.996z"
               		 />
               	   </svg>

               		   </div>


               	 <span class="op-line op-top">
               	   <!-- Decena: tachado y reemplazo -->
               	   <span class="op-digit">
               		 <span class="strike">2</span>
               		 <span class="borrowed">1</span>
               	   </span>
               		   <span class="op-digit" style="position: relative;">
               		 0

               			 <!-- Unidad: muestra un carry flotando a su izquierda -->
               			   <span class="carry" style="--carry-x: 1.35em;--carry-y: 0.75em;">1</span>
               	   </span>


               	   <span class="op-digit">
               		 3
               	   </span>
               	 </span>

               	 <span class="op-line">
               	   <span class="op-sign">-</span>
               	   <span class="op-bottom">
               		 <span class="op-digit">1</span>
               		 <span class="op-digit">7</span>
               		 <span class="op-digit">8</span>
               	   </span>
               	 </span>

               	 <hr>

               	 <span class="op-line op-result">
               		 <span class="op-digit"></span>
               	   <span class="op-digit"></span>
               	   <span class="op-digit">5</span>
               	 </span>
               </div>



               	 <li><strong>Paso 5:</strong> ¡Ya podemos restar! 13 - 8 = 5, luego 9 - 7 = 2 (porque el 0 que recibió ayuda ahora es un 9), y 1 - 1 = 0.</li>



               <div class="operation">

               		 <div class="flechas" style="margin-bottom: 0px; margin-right: 0.6em;">

               <!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
               <svg class="curved-arrow" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
               		viewBox="0 0 302.816 302.816" xml:space="preserve">
               <path id="XMLID_6_" d="M298.423,152.996c-5.857-5.858-15.354-5.858-21.213,0l-35.137,35.136
               	   c-5.871-59.78-50.15-111.403-112.001-123.706c-45.526-9.055-92.479,5.005-125.596,37.612c-5.903,5.813-5.977,15.31-0.165,21.213
               	   c5.813,5.903,15.31,5.977,21.212,0.164c26.029-25.628,62.923-36.679,98.695-29.565c48.865,9.72,83.772,50.677,88.07,97.978
               	   l-38.835-38.835c-5.857-5.857-15.355-5.858-21.213,0.001c-5.858,5.858-5.858,15.355,0,21.213l62.485,62.485
               	   c2.929,2.929,6.768,4.393,10.606,4.393s7.678-1.464,10.607-4.393l62.483-62.482C304.281,168.352,304.281,158.854,298.423,152.996z"
               	   />
               </svg>

               	   </div>


               	 <span class="op-line op-top">
               	   <!-- Decena: tachado y reemplazo -->
               	   <span class="op-digit">
               		 <span class="strike">2</span>
               		 <span class="borrowed">1</span>
               	   </span>
               	   <!-- Unidad: muestra 5 con carry flotando a su izquierda -->
               	   <span class="op-digit">
               		 <span class="strike">0</span>
               		 <span class="borrowed" style="left: 2em !important;">9</span>


               	   </span>

               	   <span class="op-digit">
               			 <!-- Unidad: muestra un carry flotando a su izquierda -->
               						 <span class="carry" style="--carry-x: 3.17em;--carry-y: 0.75em;">1</span>
               		 3
               	   </span>


               	 </span>



               	 <span class="op-line">
               	   <span class="op-sign">-</span>
               	   <span class="op-bottom">
               		 <span class="op-digit">1</span>
               		 <span class="op-digit">7</span>
               		 <span class="op-digit">8</span>
               	   </span>
               	 </span>

               	 <hr>

               	 <span class="op-line op-result">
               		 <span class="op-digit"></span>
               	   <span class="op-digit">2</span>
               	   <span class="op-digit">5</span>
               	 </span>
               </div>



               </ol>


               <p>Entonces, aunque había un 0 que no podía ayudar al principio, al final todos se ayudaron y pudimos hacer la resta bien.</p>



               	 `
               },



               /* ----------- R E S T A   C O N   S U S T R A E N D O   M A Y O R ----------- */
               restaSustraendoMayor: {
               label: 'Resta con sustraendo mayor que minuendo', symbol: '−',
               generate: () => {
               	  const a = rand(10, 99);
               	  let b = rand(a + 1, a + 20); // asegurar que b > a
               	  return [a, b];
               },
               calc: (a, b) => a - b,
               instructions: `
               	   <h2>¿Qué pasa si el sustraendo es mayor que el minuendo?</h2>

               	   <p>Ahora vamos a ver un caso diferente: <strong>15 - 17</strong>. Como verás, el minuendo (número de arriba) es menor que el sustraendo (número de abajo). En este caso, <strong>la resta dará un número negativo</strong>. Procederemos a resolver la operación:</p>

               	   <ul>
               		 <li><strong>Paso 1:</strong> Voltea los números para que el número mayor esté arriba y el menor abajo.</li>

               		 <div class="two-operations">
               		   <div class="operation">
               			 <span class="op-line op-top">  15</span>
               			 <span class="op-line"><span class="op-sign">-</span><span class="op-bottom"> 17</span></span>
               			 <hr>
               		   </div>



               		   <svg class="normal-arrow" version="1.0" xmlns="http://www.w3.org/2000/svg"
               		   width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000"
               		   preserveAspectRatio="xMidYMid meet">
               		   <metadata>
               		   Created by potrace 1.15, written by Peter Selinger 2001-2017
               		   </metadata>
               		   <g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)" stroke="none">
               		   <path d="M8590 5015 c0 -3 7 -19 15 -36 34 -65 185 -442 228 -569 92 -273 172
               		   -639 179 -827 l3 -63 -4508 0 -4507 0 0 -315 0 -315 4511 0 4511 0 -6 -67
               		   c-10 -99 -53 -352 -81 -473 -49 -219 -128 -447 -268 -780 -41 -96 -73 -176
               		   -72 -177 4 -6 348 140 1915 815 784 338 2102 911 2223 967 32 15 55 31 50 35
               		   -4 4 -55 28 -113 53 -58 25 -199 86 -315 137 -244 107 -485 212 -1572 681
               		   -692 299 -1791 769 -2160 926 -18 7 -33 11 -33 8z"/>
               		   </g>
               		   </svg>

               		   <div class="operation">
               			 <span class="op-line op-top">  17</span>
               			 <span class="op-line"><span class="op-sign">-</span><span class="op-bottom"> 15</span></span>
               			 <hr>
               		   </div>
               		 </div>
               	   </ul>

               	   <ul>
               		 <li><strong>Paso 2:</strong> Ahora podemos restar: 7 - 5 = 2.</li>

               		 <div class="operation">
               		   <span class="op-line op-top">  17</span>
               		   <span class="op-line"><span class="op-sign">-</span><span class="op-bottom"> 15</span></span>
               		   <hr>
               		   <span class="op-line op-result">2</span>
               		 </div>

               		 <li><strong>Paso 3:</strong> Hacemos lo mismo con la decena: 1 - 1 = 0. Como en las operaciones con números naturales, los ceros a la izquierda no tienen valor numérico, por lo tanto se pueden eliminar sin cambiar el resultado.</li>

               		 <li><strong>Paso 4:</strong> En las operaciones donde el minuendo es menor que el sustraendo, el resultado se transforma en un número <strong>negativo</strong>. Solo debemos pasar la resta a limpio, volver a invertir el orden de los números, anotar el resultado (2) y añadirle un signo menos.</li>
               	   </ul>

               	   <p><strong>Resultado final:</strong></p>



               	   <div class="two-operations">
               		 <div class="operation">
               		   <span class="op-line op-top">  17</span>
               		   <span class="op-line"><span class="op-sign">-</span><span class="op-bottom"> 15</span></span>
               		   <hr>
               		   <span class="op-line op-result">2</span>
               		 </div>



               		 <svg class="normal-arrow" version="1.0" xmlns="http://www.w3.org/2000/svg"
               		 width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000"
               		 preserveAspectRatio="xMidYMid meet">
               		 <metadata>
               		 Created by potrace 1.15, written by Peter Selinger 2001-2017
               		 </metadata>
               		 <g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)" stroke="none">
               		 <path d="M8590 5015 c0 -3 7 -19 15 -36 34 -65 185 -442 228 -569 92 -273 172
               		 -639 179 -827 l3 -63 -4508 0 -4507 0 0 -315 0 -315 4511 0 4511 0 -6 -67
               		 c-10 -99 -53 -352 -81 -473 -49 -219 -128 -447 -268 -780 -41 -96 -73 -176
               		 -72 -177 4 -6 348 140 1915 815 784 338 2102 911 2223 967 32 15 55 31 50 35
               		 -4 4 -55 28 -113 53 -58 25 -199 86 -315 137 -244 107 -485 212 -1572 681
               		 -692 299 -1791 769 -2160 926 -18 7 -33 11 -33 8z"/>
               		 </g>
               		 </svg>

               		 <div class="operation">
               		   <span class="op-line op-top">  15</span>
               		   <span class="op-line"><span class="op-sign">-</span><span class="op-bottom"> 17</span></span>
               		   <hr>
               		   <span class="op-line op-result">-2</span>
               		 </div>
               	   </div>

               	   <p>Este es un buen momento para aprender que a veces el resultado de una resta puede ser un <strong>número negativo</strong>. ¡Eso significa que le debemos 2!</p>

               <iframe class="iframe" src="https://www.youtube.com/embed/sApfIupQ8Gg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

               		 `
               },


               /* -------- R E S T A  D E C I M A L E S -------- */
               restaDecimales: {
               label: 'Resta con decimales', symbol: '&#8722;',
               generate: () => {
               	  let a = +(Math.random() * 90 + 10).toFixed(2);
               	  let b = +(Math.random() * 90 + 10).toFixed(2);
               	  if (b > a) [a, b] = [b, a];
               	  return [a, b];
               },
               calc: (a, b) => +(a - b).toFixed(3),
               instructions: `
               	<h2>Resta de números decimales</h2>
               	<ol>
               	<li><strong>Alinea los números por la coma decimal</strong>, completando con ceros si es necesario.<br>
               		<div class="operation">
               		<span class="op-line op-top">  15,70</span>
               		<span class="op-line"><span class="op-sign">−</span><span class="op-bottom">&nbsp;8,35</span></span>
               		</div>
               	</li>
               	<li><strong>Resta de derecha a izquierda</strong>, pidiendo prestado si hace falta. La coma del resultado se coloca alineada con las demás.<br>
               		<div class="operation">
               		<span class="op-line op-top">  15,70</span>
               		<span class="op-line"><span class="op-sign">−</span><span class="op-bottom">&nbsp;8,35</span></span>
               		<hr>
               		<span class="op-line op-result">   7,35</span>
               		</div>
               	</li>

               	<iframe class="iframe" src="https://www.youtube.com/embed/0NNshc96lDY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

               	</ol>`
               },


               /* -------- R E S T A  F R A C C I O N E S -------- */
               restaFracciones: {
               label: 'Resta de fracciones', symbol: '&#8722;',
               generate: () => {
               	  const d1 = rand(2, 9), d2 = rand(2, 9);
               	  const n1 = rand(1, d1 - 1);
               	  const n2 = rand(1, d2 - 1);
               	  // nos aseguramos de que la primera fracción sea mayor para evitar negativos
               	  if (n1 / d1 < n2 / d2) return [frac(n2, d2), frac(n1, d1)];
               	  return [frac(n1, d1), frac(n2, d2)];
               },
               calc: (a, b) => {
               	  const f1 = parseFrac(a), f2 = parseFrac(b);
               	  const m = lcm(f1.d, f2.d);
               	  const n = f1.n * (m / f1.d) - f2.n * (m / f2.d);
               	  return n / m;
               },
               instructions: `
               		 <h2>Resta de fracciones</h2>
                   <p>A continuación, veremos como resolver restas de fracciones, con mismo y distinto denominador.</p>
                   <h3><u>Resta de fracciones con mismo denominador</u></h3>
               		 <ol>
               		   <li>Si el denominador (número de abajo) es igual en ambas fracciones, restamos ambos numeradores (números superiores), dejamos el denominador igual y representamos los resultados en forma de fracción.<br>
               <div class="operation" style="display: inline-block">
               	 <span class="frac"><span class="top">3</span><span class="bottom">5</span></span>
               	 <span class="op-sign">−</span>
               	 <span class="frac"><span class="top">1</span><span class="bottom">5</span></span>
               	 <span class="equal">=</span>
               	 <span class="result"><span class="frac"><span class="top">2</span><span class="bottom">5</span></span></span>
               </div>
               		   </li>
                     </ol>


                   <h3><u>Resta de fracciones con distinto denominador</u></h3>
               		 <ol>

                   <li>Pongamos el ejemplo de que tenemos esta <strong>resta de fracciones con distinto denominador</strong>: <br/>

                            <div class="operation" style="display: inline-block">
               	 <span class="frac"><span class="top">3</span><span class="bottom">4</span></span>
               	 <span class="op-sign">−</span>
               	 <span class="frac"><span class="top">1</span><span class="bottom">5</span></span>
               	</span>
               </div>
               </li>
               		   <li>Extrae el <strong>mínimo común múltiplo</strong> de amnbos denominadores.<br>

               <div class="two-operations">
      <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">4</span>
            <span class="mcm-left-number">2</span>
            <!-- Último número en verde -->
            <span class="mcm-left-number mcm-final">1</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">2</span>
            <span class="mcm-factor">2</span>
          </div>
        </div>
      </div>

      <div class="operation mcm-decomp">
        <div class="mcm-line">
          <!-- Columna izquierda -->
          <div class="mcm-left">
            <span class="mcm-left-number">5</span>
            <span class="mcm-left-number mcm-final">1</span>
          </div>

          <!-- Línea vertical -->
          <div class="mcm-bar"></div>

          <!-- Columna derecha -->
          <div class="mcm-right">
            <span class="mcm-factor">5</span>
          </div>
        </div>
      </div>
      </div>

      <br/>

      <div class="operation-vertical">
       <span style="color: var(--clr-bottom)">
      <span class="number">2<sup>2</sup></span> × 5</span> = <span style="color: var(--clr-result)">20</span>
      </div>

               		   </li>



        <li>Coloca los denominadores en su lugar y luego <strong>multiplica cada numerador por el número necesario para que el denominador llegue al mínimo común múltiplo (m.c.m.)</strong>. Por ejemplo: si uno de los denominadores es 4, para convertirlo en 20 (que es el m.c.m. entre 4 y 5), debes multiplicarlo por 5. Del otro lado, si el denominador es 5, multiplícalo por 4 para llegar a 20. <strong>Es muy importante mantener la equivalencia de las fracciones, por lo que debes multiplicar tanto el numerador como el denominador por el mismo número</strong>.<br/>        <div class="operation" style="display: inline-block">
               	 <div class="center">
                 <span class="frac"><span class="top">3</span><span class="bottom">4</span></span>
               	 <span class="op-sign">−</span>
               	 <span class="frac"><span class="top">1</span><span class="bottom">5</span></span>

               	     <span class="center-arrow width-arrow">
               				<svg class="normal-arrow-divisions" version="1.0" xmlns="http://www.w3.org/2000/svg" width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000" preserveAspectRatio="xMidYMid meet">
               				<metadata>
               				Created by potrace 1.15, written by Peter Selinger 2001-2017
               				</metadata>
               				<g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)" stroke="none">
               				<path d="M8590 5015 c0 -3 7 -19 15 -36 34 -65 185 -442 228 -569 92 -273 172
               				-639 179 -827 l3 -63 -4508 0 -4507 0 0 -315 0 -315 4511 0 4511 0 -6 -67
               				c-10 -99 -53 -352 -81 -473 -49 -219 -128 -447 -268 -780 -41 -96 -73 -176
               				-72 -177 4 -6 348 140 1915 815 784 338 2102 911 2223 967 32 15 55 31 50 35
               				-4 4 -55 28 -113 53 -58 25 -199 86 -315 137 -244 107 -485 212 -1572 681
               				-692 299 -1791 769 -2160 926 -18 7 -33 11 -33 8z"></path>
               				</g>
               				</svg>
               			</span>
               	 <span class="result"><span class="frac">
                  <span class="frac"><span class="top">3 × 5</span><span class="bottom">4 × 5</span></span>
               	  <span class="op-sign signo-center">−</span>
               	  <span class="frac"><span class="top">1 × 4</span><span class="bottom">5 × 4</span></span>
               	 </span></span>
               </div>
               </div>
               		   </li>




                              		   <li>Realiza la <strong>multiplicación</strong> y coloca los resultados en forma de fracciones.<br>
               <div class="operation" style="display: inline-block">
               	 <span class="frac">
                 <span class="top">3</span>
                 <span class="bottom">4</span></span>

               	 <span class="op-sign">−</span>

               	 <span class="frac">
                 <span class="top">1</span>
                 <span class="bottom">5</span></span>

               	 <span class="equal">=</span>
               	 <span class="result">
                 <span class="frac">
                 <span class="top">15</span>
                 <span class="bottom">20</span></span>

               	 <span class="op-sign">−</span>

               	 <span class="frac">
                 <span class="top">4</span>
                 <span class="bottom">20</span>
                 </span></span>
               </div>
               		   </li>



                                             		   <li>Realiza la <strong>resta de los numeradores</strong>.<br>
               <div class="operation" style="display: inline-block">
               	 <span class="frac">
                 <span class="top">15</span>
                 <span class="bottom">20</span></span>

               	 <span class="op-sign">−</span>

               	 <span class="frac">
                 <span class="top">4</span>
                 <span class="bottom">20</span></span>

               	 <span class="equal">=</span>
               	 <span class="result">
                 <span class="frac">
                 <span class="top">11</span>
                 <span class="bottom">20</span></span>
                 </span></span>
               </div>
               		   </li>

               		 </ol>

                   <iframe class="iframe" src="https://www.youtube.com/embed/rSLuXOTdje8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>


                                      `
               },

               /* --- M U L T I P L I C A C I Ó N   2   C I F R A S --- */
               multiplicacion2: {
               label: 'Multiplicación de dos o más cifras', symbol: '&times;',
               generate: () => {
               	  const probabilidad = Math.random();
               	  if (probabilidad < 0.2) {
               		  // 20%: tres cifras x tres cifras
               		  return [rand(100, 999), rand(100, 999)];
               	  } else {
               		  // 80%: tres cifras x dos cifras
               		  if (Math.random() < 0.5) {
               			  return [rand(100, 999), rand(10, 99)];
               		  } else {
               			  return [rand(10, 99), rand(100, 999)];
               		  }
               	  }
               },
               calc: (a, b) => a * b,
               instructions: `
               			 <h2>Multiplicación de dos o más cifras</h2>
               			 <ol>
               			   <li>Escribe los dos <strong>factores</strong> uno debajo del otro y alinea a la derecha.<br>
               			   <div class="operation">
               				 <span class="op-line op-top">  523</span>
               				 <span class="op-line"><span class="op-sign">×</span><span class="op-bottom"> 14</span></span>
               			   </div>
               			   </li>
               			   <li>Multiplica la cifra de las <strong>unidades</strong> del número inferior por cada una de las cifras del número superior.<br>
               			   <div class="operation" style="margin-top: 12px;">
               				 <span class="op-line">
               					<span class="carry" style="--carry-x:-2em; --carry-y:-0.9em">1</span>
               				</span>
               				 <span class="op-line op-top">  523</span>
               				 <span class="op-line"><span class="op-sign">×</span><span class="op-bottom"> 14</span></span>
               				 <hr>
               				 <span class="op-line op-step"> 2092</span>
               			   </div>
               			   </li>
               			   <li>
               			   	Coloca un <strong>cero</strong> en la fila siguiente, justo en la columna de las <em>unidades</em>, para indicar que ahora estás multiplicando por la <strong>decena</strong> del segundo número.<br>
               				Luego, multiplica la segunda cifra (la decena del segundo factor) por cada una de las cifras del número superior, comenzando por la derecha, y escribe el resultado alineado correctamente.
               				</li>
               			   <div class="operation">
               				 <span class="op-line op-top">  523</span>
               				 <span class="op-line"><span class="op-sign">×</span><span class="op-bottom"> 14</span></span>
               				 <hr>
               				 <span class="op-line op-step"> 2092</span>
               				 <span class="op-line op-step">+5230</span>
               			   </div>
               			   </li>
               			   <li>Ahora, sumamos los <strong>productos parciales</strong> para obtener el resultado final.<br>
               			   <div class="operation">
               				 <span class="op-line op-top">  523</span>
               				 <span class="op-line"><span class="op-sign">×</span><span class="op-bottom"> 14</span></span>
               				 <hr>
               				 <span class="op-line op-step"> 2092</span>
               				 <span class="op-line op-step">+5230</span>
               				 <hr>
               				 <span class="op-line op-result">7322</span>
               			   </div>
               			   </li>
               			   <iframe class="iframe" src="https://www.youtube.com/embed/3D658NAXfe4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

               			 </ol>`
               },


               /* ---------------- MULTIPLICACIÓN DE ENTEROS ---------------- */
              multiplicacionFracciones: {
                label: 'Multiplicación de fracciones',
                symbol: '×',

                // Genera dos fracciones propias positivas
                generate: () => {
                  const d1 = rand(2, 9), d2 = rand(2, 9);
                  const n1 = rand(1, d1 - 1); // Solo positivos
                  const n2 = rand(1, d2 - 1); // Solo positivos

                  return [frac(n1, d1), frac(n2, d2)];
                },

                // Calcula el valor decimal del producto
                calc: (a, b) => {
                  const f1 = parseFrac(a);
                  const f2 = parseFrac(b);
                  return (f1.n * f2.n) / (f1.d * f2.d);
                },
               instructions: `
               		 <h2>Multiplicación de fracciones</h2>
                   <p>A continuación, veremos como resolver multiplicación de fracciones.</p>

               		 <ol>

                   <li>Pongamos el ejemplo de que tenemos esta <strong>multiplicación de fracciones con distinto denominador</strong>: <br/>

                            <div class="operation" style="display: inline-block">
               	 <span class="frac"><span class="top">3</span><span class="bottom">4</span></span>
               	 <span class="op-sign">×</span>
               	 <span class="frac"><span class="top">10</span><span class="bottom">15</span></span>
               	</span>
               </div>
               </li>

      <li>Para multiplicar fracciones, <strong>multiplica el numerador de la primera fracción por el numerador de la segunda</strong>. Luego, <strong>haz lo mismo con los denominadores</strong>. El resultado será una nueva fracción formada por estos dos productos.<br/>

               <div class="operation">
                <div class="center">
                  <span class="frac">
                      <span class="top">3 × 10</span>
                      <span class="bottom">4 × 15</span>
                    </span>
                </div>
               </div>
               </li>
               		   </li>




                              		   <li>Realiza la <strong>multiplicación</strong> y coloca el resultado en forma de fracción.<br>
                  <div class="operation" style="display: inline-block">
               	 <span class="frac"><span class="top">30</span><span class="bottom">60</span></span>
               	</span>
               </div>
               		   </li>


               		 </ol>

                   <iframe class="iframe" src="https://www.youtube.com/embed/pHWhPo4_21s" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>



               	 `
               },

               /* ---------------- MULTIPLICACIÓN DE ENTEROS ---------------- */
      	multiplicacionEnteros: {
      	label: 'Multiplicación de números enteros',
      	symbol: '×',
      	generate: () => {
      		const a = rand(-12, 12);
      		const b = rand(-12, 12);
      		return [a, b, '×'];           // ← tercer dato = símbolo
      	},
      	calc: (a, b) => a * b,
      	instructions: `
               <h2>Multiplicación de números enteros</h2>

               <p>El producto de dos números enteros es otro número entero cuyo valor absoluto es el producto de los valores absolutos de los factores.
               El signo del resultado se determina con la siguiente tabla de signos:</p>


               <table cellspacing="0" cellpadding="0" style="border-collapse: collapse; border: 1px solid #333;">
               <thead style="background-color: #add8ec;color: #000000;">
               <tr>
               <th style="border: 1px solid #333;padding: 5px;font-weight: 500;">Factor 1</th>
               <th style="border: 1px solid #333;padding: 5px;font-weight: 500;">Factor 2</th>
               <th style="border: 1px solid #333;padding: 5px;font-weight: 500;">Producto</th>
               </tr>
               </thead>
               <tbody style="background-color: #fafafa;">
               <tr>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               </tr>
               <tr>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               </tr>
               <tr>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               </tr>
               <tr>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               </tr>
               </tbody>
               </table>

               <p>
               O lo que es lo mismo: <strong><u>si los signos son iguales, se asigna al resultado un signo positivo (+), si son distintos, uno negativo (-)</u></strong>
               </p>
               <h3>Paso a paso</h3>
               <ol>
               <li>Extrae los valores absolutos de ambos factores. Esto se realiza ignorando los signos y extrayendo solo los números. Los valore absolutos se colocan habitualmente entre barras verticales (|).<br/>
               						<div class="two-divisions">
               						<div class="operation">
               						<span class="op-line op-top"><strong>(-12)</strong></span>
               						<span class="op-line"><span class="op-sign"><strong>×</strong></span><span class="op-bottom"><strong>(+6)</strong></span></span>
               						<hr>
               						</div>
               						<span class="center-arrow" style="margin: auto 3em !important;">
               							<svg class="normal-arrow-divisions" version="1.0" xmlns="http://www.w3.org/2000/svg" width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000" preserveAspectRatio="xMidYMid meet">
               							<metadata>
               							Created by potrace 1.15, written by Peter Selinger 2001-2017
               							</metadata>
               							<g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)" stroke="none">
               							<path d="M8590 5015 c0 -3 7 -19 15 -36 34 -65 185 -442 228 -569 92 -273 172
               							-639 179 -827 l3 -63 -4508 0 -4507 0 0 -315 0 -315 4511 0 4511 0 -6 -67
               							c-10 -99 -53 -352 -81 -473 -49 -219 -128 -447 -268 -780 -41 -96 -73 -176
               							-72 -177 4 -6 348 140 1915 815 784 338 2102 911 2223 967 32 15 55 31 50 35
               							-4 4 -55 28 -113 53 -58 25 -199 86 -315 137 -244 107 -485 212 -1572 681
               							-692 299 -1791 769 -2160 926 -18 7 -33 11 -33 8z"></path>
               							</g>
               							</svg>
               						</span>
               						<div class="operation">
               							<span class="op-line op-top"><strong>|12|</strong></span>
               							<span class="op-line"><span class="op-sign"><strong>×</strong></span><span class="op-bottom"><strong>&nbsp;|6|</strong></span></span>
               							<hr>
               						</div>
               						</div>

               						</li>


               						<li>Multiplica los valores absolutos de los factores. <br/>

               						<div class="operation">
               							<span class="op-line op-top"><strong>|12|</strong></span>
               							<span class="op-line"><span class="op-sign"><strong>×</strong></span><span class="op-bottom"><strong>&nbsp;|6|</strong></span></span>
               							<hr>
               							<span class="op-line op-result"><strong>72&nbsp;</strong></span>
               						</div>


               					 </li>
               <li>Determina el signo según la tabla anterior y coloca el signo al resultado. Como en nuestro ejemplo, teníamos (+) × (-), deberemos colocar un signo negativo (-).
               						<div class="operation">
               							<span class="op-line op-top"><strong>|12|</strong></span>
               							<span class="op-line"><span class="op-sign"><strong>×</strong></span><span class="op-bottom"><strong>&nbsp;|6|</strong></span></span>
               							<hr>
               							<span class="op-line op-result"><strong>-72&nbsp;</strong></span>
               						</div>
               					 </li>
               </ol>

               <p>La multiplicación de números enteros tiene las mismas propiedades que la multiplicación de números naturales (conmutativa, asociativa y distributiva).</p>


               				             <iframe class="iframe" src="https://www.youtube.com/embed/-ngjIgOKwlk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>


               `
               },


               /* -------- M U L T I P L I C A C I Ó N  D E C I M A L E S -------- */
               multiplicacionDecimales: {
               label: 'Multiplicación con decimales', symbol: '&times;',
               generate: () => [+(Math.random() * 9 + 1).toFixed(2), +(Math.random() * 90 + 10).toFixed(1)],
               calc: (a, b) => +(a * b).toFixed(4),
               instructions: `
               <h2>Multiplicación con números decimales</h2>
               <ol>
               <li><strong>Escribe los números uno debajo del otro</strong> como si no tuvieran comas, asegurándote de alinear el número de abajo a la derecha.<br>
               <div class="operation">
               <span class="op-line op-top">   2,5</span>
               <span class="op-line"><span class="op-sign">×</span><span class="op-bottom">&nbsp;&nbsp;1,2</span></span>
               </div>
               </li>
               <li><strong>Multiplica como si fueran números enteros</strong>, ignorando las comas decimales.</li>
               <li><strong>Cuenta cuántas cifras decimales</strong> hay en total entre ambos factores (por ejemplo, 1 cifra en "2,5" y 1 cifra en "1,2" = 2 cifras).</li>

               <div class="operation">
               <span class="op-line op-top">   2,5</span>
               <span class="op-line"><span class="op-sign">×</span><span class="op-bottom">&nbsp;&nbsp;1,2</span></span>
               <hr>
               <span class="op-line op-result">  300</span>
               </div>

               <li><strong>Coloca la coma en el producto final</strong>, dejando tantas cifras decimales como sumaste en el paso anterior.<br>
               <div class="operation">
               <span class="op-line op-top">   2,5</span>
               <span class="op-line"><span class="op-sign">×</span><span class="op-bottom">&nbsp;&nbsp;1,2</span></span>
               <hr>
               <span class="op-line op-result">3,00</span>
               </div>
               </li>

               <iframe class="iframe" src="https://www.youtube.com/embed/jCzO_bZXEvM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>


               </ol>`
               },

               /* --------------- D I V I S I Ó N --------------- */
               division: {
               label: 'División de 1 cifra', symbol: '&#247;',
               generate: () => [rand(100, 999), rand(2, 9)],
               calc: (a, b) => a / b,
               instructions: `
               <h2>División entre una cifra</h2>
               <ol style="margin-bottom: 0em !important;">
               <li>
               Coloca el <strong>dividendo</strong> a la izquierda y el <strong>divisor</strong> de una cifra dentro del símbolo en "L" invertida.<br>
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">125</div>
               <div class="divisor-wrapper">
               <div class="divisor">5&nbsp;</div>
               </div>
               </div>
               </li>

               <li>
               Comienza observando la primera cifra del dividendo. Si es menor que el divisor, tomamos las dos primeras cifras.

               			   <div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span style="color: var(--clr-rose);">1</span>25


               				<svg class="carry curved-arrow" style="--carry-x:0.7em; --carry-y:-0.9em" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
               					viewBox="0 0 302.816 302.816" xml:space="preserve">
               				<path id="XMLID_6_" d="M298.423,152.996c-5.857-5.858-15.354-5.858-21.213,0l-35.137,35.136
               					c-5.871-59.78-50.15-111.403-112.001-123.706c-45.526-9.055-92.479,5.005-125.596,37.612c-5.903,5.813-5.977,15.31-0.165,21.213
               					c5.813,5.903,15.31,5.977,21.212,0.164c26.029-25.628,62.923-36.679,98.695-29.565c48.865,9.72,83.772,50.677,88.07,97.978
               					l-38.835-38.835c-5.857-5.857-15.355-5.858-21.213,0.001c-5.858,5.858-5.858,15.355,0,21.213l62.485,62.485
               					c2.929,2.929,6.768,4.393,10.606,4.393s7.678-1.464,10.607-4.393l62.483-62.482C304.281,168.352,304.281,158.854,298.423,152.996z"
               					/>
               				</svg>


               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">5&nbsp;</div>
               					</div>
               				</div>
               </li>

               <li>
               Como 1 es menor que 5, tomamos las dos primeras cifras: <strong>12</strong>.
               			   <div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">12</span>5

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">5&nbsp;</div>
               					</div>
               				</div>
               </div>
               </li>

               <li>
               Calculamos mentalmente cuántas veces cabe 5 en 12 sin pasarse. Sabemos que 5 × 2 = 10 y 5 × 3 = 15, que se pasa. Entonces escribimos el <strong>2</strong> en el cociente y el <strong>10</strong> debajo del 12.
               				<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">12</span>5
               					<div class="step">10&nbsp;</div>

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">5&nbsp;</div>
               					<div class="quotient">2</div>
               					</div>
               				</div>

               </li>

               <li>
               Restamos: 12 - 10 = 2. Anotamos ese resultado.
               				<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">12</span>5
               					<div class="step">-10&nbsp;
               					<hr style="width: 2em !important;"/>
               					</div>
               					<div class="step">2&nbsp;</div>

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">5&nbsp;</div>
               					<div class="quotient">2</div>
               					</div>
               				</div>

               </li>

               <li>
               Bajamos la siguiente cifra del dividendo: el <strong>5</strong>. Ahora tenemos 25.
               				<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">12</span>5
               					<div class="step">-10&nbsp;
               					<hr style="width: 2em !important;"/>
               					</div>
               					<div class="step">2<span style="color: var(--clr-rose) !important;">5</span></div>

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">5&nbsp;</div>
               					<div class="quotient">2</div>
               					</div>
               				</div>


               </li>

               <li>
               Calculamos cuántas veces cabe 5 en 25. 5 × 5 = 25. Anotamos el <strong>5</strong> en el cociente y el <strong>25</strong> debajo. Restamos: 25 - 25 = 0. Como ya no quedan cifras, y el resto es cero, se trata de una <strong>división exacta</strong>.
               				<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">12</span>5
               					<div class="step">-10&nbsp;
               					<hr style="width: 2em !important;"/>
               					</div>
               					<div class="step">2<span style="color: var(--clr-rose) !important;">5</span></div>
               					<div class="step">-25
               					<hr style="width: 2em !important; margin-left: 1rem;"/>
               					<div class="remainder pick">0</div>&nbsp;
               					</div>


               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">5&nbsp;</div>
               					<div class="quotient">25</div>
               					</div>
               				</div>
               			   </li>

               <li style="margin-bottom: 12px;">
               ¡Y así hemos completado la división correctamente!
               </li>


               	   <iframe class="iframe" src="https://www.youtube.com/embed/0D1wxxlBN-0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
               </ol>


               <!-- ================== Extra: página 1 ================== -->
               <h2 style="border-bottom: 2px solid #ccc; padding-bottom: 0.3em; margin-top: 2em;">
               🔴 Extra: 0 al cociente y sigo al siguiente número
               </h2>

               <ol>
               <p>Cuando al bajar una cifra el número es menor que el divisor, escribimos un <strong>0 en el cociente</strong> y bajamos la siguiente cifra. Este paso es esencial para mantener el lugar correcto de cada cifra en el cociente.</p>

               <!-- EJEMPLO: 8025 ÷ 5 -->
               <li>Comenzamos dividiendo el primer número que sí se puede dividir entre el divisor. Si sobra algo, bajamos la siguiente cifra para continuar la división.</li>


               					<div class="long-division">
               						<div class="dividend-wrapper" style="position: relative;">
               						<span class="pick">8</span>025
               						<div class="step">-5&nbsp;&nbsp;&nbsp;
               						<hr style="width: 1.4em !important;">
               						</div>
               						<div class="step">30&nbsp;&nbsp;</div>



               						</div>

               						<div class="divisor-wrapper">
               						<div class="divisor">5&nbsp;&nbsp;</div>
               						<div class="quotient">1</div>
               						</div>

               					</div>

               <li>Ahora dividimos 30 ÷ 5 = 6, sobra 0. Bajamos el siguiente número: <strong>2</strong>. Pero 2 es menor que 5, así que colocamos un <strong>0 en el cociente</strong> y bajamos el siguiente dígito.

               								 <div class="long-division">
               							<div class="dividend-wrapper" style="position: relative;">
               								<span class="pick">8</span>025
               								<div class="step">-5&nbsp;&nbsp;&nbsp;
               								<hr style="width: 1.4em !important;">
               								</div>
               								<div class="step">30&nbsp;&nbsp;</div>

               								<div class="step">-30&nbsp;&nbsp;<hr style="width: 1.8em;"></div>
               								<div class="step">0<span class="pick">2</span><span style="color: var(--clr-rose) !important;">5</span></div>
               							</div>

               						<div class="divisor-wrapper">
               						<div class="divisor">5&nbsp;&nbsp;</div>
               						<div class="quotient">16<span style="color: var(--clr-rose) !important;">0</span></div>

               					</div>
               </div>


               </li>

               <li>Ahora tenemos 25 ÷ 5 = 5, sin resto. Terminamos la división.


               					<div class="long-division">
               						<div class="dividend-wrapper" style="position: relative;">
               						<span class="pick">8</span>025
               						<div class="step">-5&nbsp;&nbsp;&nbsp;
               						<hr style="width: 2em !important;margin-left: 0.32em">
               						</div>
               						<div class="step">30&nbsp;&nbsp;</div>
               						<div class="step">-&nbsp;30&nbsp;&nbsp;
               						<hr style="width: 2.5em !important; margin-left: 0.4em">
               						</div>
               						<div class="remainder pick">25</div>&nbsp;&nbsp;
               						</div>

               						<div class="divisor-wrapper">
               						<div class="divisor">5</div>
               						<div class="quotient">160</div>
               						</div>

               					</div>


               </li>

               <p>Resultado: <strong>8025 ÷ 5 = 1605</strong>. El 0 en el cociente aparece cuando bajamos una cifra (el 2) que era menor que el divisor (5).</p>

               			   <iframe class="iframe" src="https://www.youtube.com/embed/Jrrl_dz7r28" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>


               </ol>


               `
               },
               /* --- D I V I S I Ó N   D E   2   O   M Á S   C I F R A S --- */
               division2: {
               label: 'División de 2 o más cifras', symbol: '&#247;',
               generate: () => {
               	  const dividendo = rand(100, 9999);
               	  const divisor = Math.random() < 0.2 ? rand(100, 999) : rand(10, 99);
               	  return [dividendo, divisor];
               },
               calc: (a, b) => a / b,
               instructions: `
               <h2>División entre dos o más cifras</h2>
               <ol style="margin-bottom: 0em !important;">
               <li>
               Coloca el <strong>dividendo</strong> a la izquierda y el <strong>divisor</strong> (de dos o más cifras) dentro del símbolo en forma de "L" invertida.
               <br>
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">8321</div>
               <div class="divisor-wrapper">
               <div class="divisor">38&nbsp;</div>
               </div>
               </div>
               </li>

               <li><strong>Comenzamos comparando</strong> las dos primeras cifras del dividendo con el divisor. Siempre se deben seleccionar las dos primeras cifras; si el número formado por ellas es menor que el divisor, se debe incluir una cifra más. En este caso, como el divisor es menor que las dos primeras cifras del dividendo, seleccionamos estas. Así, tomamos las dos primeras cifras, obteniendo el número <strong>83</strong>.
               <br/>

               <div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">83</span>21

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">38&nbsp;</div>
               					</div>
               				</div>
               </div>
               </li>

               <li><strong>A continuación, ignoraremos temporalmente las unidades</strong> y nos quedaremos únicamente con las decenas. Por ejemplo: debemos dividir <strong>83 entre 38</strong>. Como no conocemos la tabla del 83 ni del 38, lo que haremos será comparar solo las cifras de las decenas. Es decir, <em>ignoramos el <strong>3</strong> del 83 y el <strong>8</strong> del 38</em>, comparando únicamente el <strong>8 con el 3</strong>. En este caso, se trata de averiguar cuántas veces cabe el 3 en el 8. El valor más cercano es <strong>2</strong>, ya que <strong>3 × 2 = 6</strong>. Anotamos ese resultado en el cociente.
               <br/>
               						<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">8<span style="color: #ddd !important;">3</span></span>21

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">3<span style="color: #ddd !important;">8</span>&nbsp;</div>
               					<div class="quotient">2</div>
               					</div>
               				</div>

               </li>

               <li>En el siguiente paso, deberemos <strong>multiplicar el divisor por el cociente</strong> y anotar el resultado debajo del dividendo. En nuestro ejemplo, descubrimos que <strong>38 × 2 = 76</strong>.
               <br/>
               							<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">83</span>21
               					<div class="step">76&nbsp;&nbsp;</div>

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">38&nbsp;</div>
               					<div class="quotient">2</div>
               					</div>
               				</div>


               </li>

               <li>Luego, realizamos la <strong>resta normalmente</strong>, como ya vimos en la división entre números de una cifra.

               <br/>



               				<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">83</span>21
               					<div class="step">-76&nbsp;&nbsp;
               					<hr style="width: 2em !important;"/>
               					</div>
               					<div class="step">07&nbsp;&nbsp;</div>

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">38&nbsp;</div>
               					<div class="quotient">2</div>
               					</div>
               				</div>


               </li>



               <li><strong>Bajamos el siguiente número</strong> (<strong>2</strong>) y continuamos haciendo la división.
               <br/>



               				<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">83</span>21
               					<div class="step">-76&nbsp;&nbsp;
               					<hr style="width: 2em !important;"/>
               					</div>
               					<div class="step">07<span style="color: var(--clr-rose) !important;">2</span>&nbsp;</div>

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">38&nbsp;</div>
               					<div class="quotient">2</div>
               					</div>
               				</div>


               </li>



               <li>Como ya vimos, debemos <strong>obviar las unidades</strong> y dividir solo las cifras de las decenas. En el ejemplo, deberemos dividir <strong>7 entre 3</strong>, lo que da un resultado de <strong>2</strong>. Lo anotamos a la derecha del cociente que ya teníamos.
               <br/>
               				<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">83</span>21
               					<div class="step">-76&nbsp;&nbsp;
               					<hr style="width: 2em !important;">
               					</div>
               					<div class="step">07<span style="color: #ddd !important;">2</span>&nbsp;</div>

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">3<span style="color: #ddd !important;">8</span>&nbsp;</div>
               					<div class="quotient">22</div>
               					</div>
               				</div>


               </li>


               <li>Realizamos la <strong>multiplicación</strong> del último número anotado en el cociente (<strong>2</strong>) por el divisor (<strong>38</strong>). <strong>2 × 38 = 76</strong>. Anotamos el resultado debajo del dividendo para hacer la resta.
               <br/>
               				<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">83</span>21
               					<div class="step">-76&nbsp;&nbsp;
               					<hr style="width: 2em !important;">
               					</div>
               					<div class="step">072&nbsp;</div>
               					<div class="step">-&nbsp;76&nbsp;
               					<hr style="width: 2.5em !important;">
               					</div>

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">38&nbsp;</div>
               					<div class="quotient">22</div>
               					</div>
               				</div>


               </li>

               <li>Habrá veces, como en este ejemplo, en que <u>nos pasemos</u>. En este caso, debemos <strong>corregir el ejercicio</strong>. Por tanto, <u>borramos el 2 del cociente</u> y lo cambiamos por el número inmediatamente inferior (<strong>1</strong>). <strong>1 × 38 = 38</strong>. Realizamos la resta normalmente.
               <br/>

               				<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">83</span>21
               					<div class="step">-76&nbsp;&nbsp;
               					<hr style="width: 2em !important;">
               					</div>
               					<div class="step">072&nbsp;</div>
               					<div class="step">-&nbsp;38&nbsp;
               					<hr style="width: 2.5em !important;">
               					</div>
               					<div class="step">&nbsp;34&nbsp;</div>

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">38&nbsp;</div>
               					<div class="quotient">21</div>
               					</div>
               				</div>

               </li>


               <li><strong>Continuamos bajando</strong> el <strong>1</strong>.
               <br/>


               				<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">83</span>21
               					<div class="step">-76&nbsp;&nbsp;
               					<hr style="width: 2em !important;">
               					</div>
               					<div class="step">072&nbsp;</div>
               					<div class="step">-&nbsp;38&nbsp;
               					<hr style="width: 2.5em !important;">
               					</div>
               					<div class="step">&nbsp;34<span style="color: var(--clr-rose) !important;">1</span></div>

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">38&nbsp;</div>
               					<div class="quotient">21</div>
               					</div>
               				</div>

               </li>




               <li>Para encontrar el número que divide, volvemos a <strong>ignorar las unidades</strong>, con lo cual deberíamos encontrar qué número multiplicado por <strong>3</strong> da <strong>34</strong> sin pasarse. Es importante saber que solo se puede buscar un número que sea unitario (del <strong>1 al 9</strong>). Por tanto, colocamos el <strong>9</strong>, ya que <strong>3 × 9 = 27</strong>. Anotamos el resultado en el cociente.
               <br/>

               				<div class="long-division">
               					<div class="dividend-wrapper" style="position: relative;">
               					<span class="pick">83</span>21
               					<div class="step">-76&nbsp;&nbsp;
               					<hr style="width: 2em !important;">
               					</div>
               					<div class="step">072&nbsp;</div>
               					<div class="step">-&nbsp;38&nbsp;
               					<hr style="width: 2.5em !important;">
               					</div>
               					<div class="step">&nbsp;34<span style="color: #ddd !important;">1</span></div>

               					</div>
               					<div class="divisor-wrapper">
               					<div class="divisor">3<span style="color: #ddd !important;">8</span>&nbsp;</div>
               					<div class="quotient">219</div>
               					</div>
               				</div>

               </li>



               <li>Hacemos la <strong>multiplicación</strong> del último número del cociente por el divisor, lo colocamos debajo a la izquierda y lo preparamos para la resta.
               <br/>

               					<div class="long-division">
               						<div class="dividend-wrapper" style="position: relative;">
               						<span class="pick">83</span>21
               						<div class="step">-76&nbsp;&nbsp;
               						<hr style="width: 2em !important;margin-left: 0.32em">
               						</div>
               						<div class="step">072&nbsp;</div>
               						<div class="step">-&nbsp;38&nbsp;
               						<hr style="width: 2.5em !important; margin-left: 0.4em">
               						</div>
               						<div class="step">&nbsp;341</div>

               						<div class="step">-&nbsp;342
               						<hr style="width: 2.5em !important; margin-left: 1em"></div>
               						</div>

               						<div class="divisor-wrapper">
               						<div class="divisor">38&nbsp;</span></div>
               						<div class="quotient">219</div>
               						</div>

               					</div>
               </li>

               <li>Como podrás observar, <u>volvemos a pasarnos</u>, ya que no podemos realizar la resta <strong>341 - 342</strong>. Por ello, <strong>corregimos el cociente</strong> a un número inferior, volvemos a realizar la multiplicación (<strong>8 × 38 = 304</strong>), colocamos el resultado y hacemos la resta.
               <br/>

               								<div class="long-division">
               						<div class="dividend-wrapper" style="position: relative;">
               						<span class="pick">83</span>21
               						<div class="step">-76&nbsp;&nbsp;
               						<hr style="width: 2em !important;margin-left: 0.32em">
               						</div>
               						<div class="step">072&nbsp;</div>
               						<div class="step">-&nbsp;38&nbsp;
               						<hr style="width: 2.5em !important; margin-left: 0.4em">
               						</div>
               						<div class="step">&nbsp;341</div>

               						<div class="step">-&nbsp;304
               						<hr style="width: 2.5em !important; margin-left: 1em"></div>
               						<div class="step">037</div>
               						</div>

               						<div class="divisor-wrapper">
               						<div class="divisor">38</span></div>
               						<div class="quotient">218</div>
               						</div>

               					</div>
               </li>


               <li>Ya no hay más números que bajar, así que <strong>cerramos el resto</strong> y ya tendríamos hecha la división.
               <br/>
               								<div class="long-division">
               						<div class="dividend-wrapper" style="position: relative;">
               						<span class="pick">83</span>21
               						<div class="step">-76&nbsp;&nbsp;
               						<hr style="width: 2em !important;margin-left: 0.32em">
               						</div>
               						<div class="step">072&nbsp;</div>
               						<div class="step">-&nbsp;38&nbsp;
               						<hr style="width: 2.5em !important; margin-left: 0.4em">
               						</div>
               						<div class="step">&nbsp;341</div>

               						<div class="step">-&nbsp;304
               						<hr style="width: 2.5em !important; margin-left: 1em"></div>
               						<div class="remainder pick">037</div>
               						</div>

               						<div class="divisor-wrapper">
               						<div class="divisor">38</span></div>
               						<div class="quotient">218</div>
               						</div>

               					</div>
               </li>




               	   <iframe class="iframe" src="https://www.youtube.com/embed/mEqZ_8oZ_H0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>


               <hr>
               <h3>Extra: ¿Cómo divido entre más cifras?</h3>

               <p>Cuando dividimos entre números de <strong>3 o más cifras</strong>, el procedimiento general es el mismo que en las divisiones por 2 cifras. Sin embargo, hay dos aspectos importantes que cambian: <strong>la cantidad de cifras del dividendo que seleccionamos al inicio</strong> y la forma en la que <strong>estimamos el cociente</strong>.</p>

               <p>En general, para comenzar la división correctamente, debemos <strong>tomar del dividendo tantas cifras como cifras tenga el divisor</strong>. Si al tomar esas cifras el número sigue siendo menor que el divisor, añadimos una cifra más del dividendo.</p>

               <p>Ahora bien, calcular cuántas veces cabe un número grande como 432 o 8759 puede ser complicado mentalmente. Por eso usamos una técnica muy práctica: <strong>tapamos temporalmente las cifras menos significativas del divisor y del número tomado del dividendo</strong>, para trabajar solo con las cifras más representativas.</p>

               <p>Por ejemplo:</p>
               <ul>
               <li>Si el divisor tiene <strong>2 cifras</strong>, tapamos la <em>unidad</em> y trabajamos con la <strong>decena</strong>.</li>
               <li>Si tiene <strong>3 cifras</strong>, tapamos la <em>decena y unidad</em> y usamos solo la <strong>centena</strong>.</li>
               <li>Si tiene <strong>4 cifras</strong>, tapamos las <em>centenas, decenas y unidades</em> y nos quedamos con la <strong>milena</strong>.</li>
               </ul>

               <p>Hacemos lo mismo con el número del dividendo que estamos usando en ese momento. Esto nos permite estimar cuántas veces puede caber el divisor de forma más sencilla. Por ejemplo, en lugar de preguntarnos <em>“¿cuántas veces cabe 432 en 2758?”</em>, tapamos y comparamos <strong>4 con 27</strong> para guiarnos en la elección del cociente.</p>

               <p>Una vez tenemos esa estimación, hacemos la multiplicación, verificamos si el resultado se pasa o no, y corregimos si es necesario. Después, seguimos el procedimiento habitual: restar, bajar la siguiente cifra y repetir hasta terminar la división.</p>

               	   <iframe class="iframe" src="https://www.youtube.com/embed/VX4dB0e1R08" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
               	   <iframe class="iframe" src="https://www.youtube.com/embed/HriZQEgct1M" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

               </ol>`


               /* División de dos cifras con tachado

               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               <span class="pick" style="display: inline-flex;"
               >8<span class="strike">3</span></span
               >21
               <div class="step">10&nbsp;</div>
               </div>
               <div class="divisor-wrapper">
               <div class="divisor" style="display: inline-flex;">
               3<span class="strike" style="color: var(--clr-divisor) !important;"
               	>8</span
               >
               </div>
               <div class="quotient">2</div>
               </div>
               </div>

               */
               },



               /* ---------------- DIVISIÓN DE ENTEROS---------------- */
               divisionEnteros: {
               label: 'División de números enteros', symbol: '÷',
               generate: () => {
               	  const divisor = rand(-12, -1) || rand(1, 12); // evita divisor = 0
               	  const quotient = rand(-10, 10);
               	  return [divisor * quotient, divisor]; // aseguro que sea exacta
               },
               calc: (a, b) => a / b,
               instructions: `
               	                   <h2>División de números enteros</h2>


               <p>Para calcular la división de números enteros se divide el valor absoluto del dividendo entre el valor absoluto del divisor.
               Al igual que en la multiplicación, si ambos tienen el mismo signo, el cociente es positivo, y si tienen distinto signo, el cociente es negativo.</p>
               <p>El signo del resultado se determina con la siguiente tabla de signos:</p>


               <table cellspacing="0" cellpadding="0" style="border-collapse: collapse; border: 1px solid #333;">
               <thead style="background-color: #add8ec;color: #000000;">
               <tr>
               <th style="border: 1px solid #333;padding: 5px;font-weight: 500;">Factor 1</th>
               <th style="border: 1px solid #333;padding: 5px;font-weight: 500;">Factor 2</th>
               <th style="border: 1px solid #333;padding: 5px;font-weight: 500;">Producto</th>
               </tr>
               </thead>
               <tbody style="background-color: #fafafa;">
               <tr>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               </tr>
               <tr>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               </tr>
               <tr>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               </tr>
               <tr>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               <td style="border: 1px solid #333; padding: 5px;">+</td>
               <td style="border: 1px solid #333; padding: 5px;">-</td>
               </tr>
               </tbody>
               </table>

               <p>
               O lo que es lo mismo: <strong><u>si los signos son iguales, se asigna al resultado un signo positivo (+), si son distintos, uno negativo (-)</u></strong>
               </p>
               <h3>Paso a paso</h3>
               <ol>
               <li>Extrae los valores absolutos del dividendo y el divisor. Esto se realiza ignorando los signos y extrayendo solo los números. Los valore absolutos se colocan habitualmente entre barras verticales (|).<br/>
               <div class="two-divisions">
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">+60</div>
               <div class="divisor-wrapper">
               <div class="divisor">-10</div>
               </div>
               </div>

               <span class="center-arrow">
               <svg class="normal-arrow-divisions" version="1.0" xmlns="http://www.w3.org/2000/svg" width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000" preserveAspectRatio="xMidYMid meet">
               <metadata>
               Created by potrace 1.15, written by Peter Selinger 2001-2017
               </metadata>
               <g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)" stroke="none">
               <path d="M8590 5015 c0 -3 7 -19 15 -36 34 -65 185 -442 228 -569 92 -273 172
               -639 179 -827 l3 -63 -4508 0 -4507 0 0 -315 0 -315 4511 0 4511 0 -6 -67
               c-10 -99 -53 -352 -81 -473 -49 -219 -128 -447 -268 -780 -41 -96 -73 -176
               -72 -177 4 -6 348 140 1915 815 784 338 2102 911 2223 967 32 15 55 31 50 35
               -4 4 -55 28 -113 53 -58 25 -199 86 -315 137 -244 107 -485 212 -1572 681
               -692 299 -1791 769 -2160 926 -18 7 -33 11 -33 8z"></path>
               </g>
               </svg>

               </span>



               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">|60|</div>
               <div class="divisor-wrapper">
               <div class="divisor">|10|</div>
               </div>
               </div>
               </div>

               						</li>


               						<li>Divide normalmente los valores absolutos de los factores. <br/>

      		<div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               |<span class="pick">60</span>|
               <div class="step">-60&nbsp;
               <hr style="width: 2em !important;">
               </div>
      		<div class="remainder pick">00</div>&nbsp;
               </div>
               <div class="divisor-wrapper">
               <div class="divisor">|10|</div>
               <div class="quotient">6</div>
               </div>
               </div>


               					 </li>
               <li>Determina el signo según la tabla anterior y coloca el signo al resultado. Como en nuestro ejemplo, teníamos (+) × (-), deberemos colocar un signo negativo (-).
      							<div class="operation">
      								<div class="op-line">
      									<span class="op-top">
      										<strong>(+60)</strong>
      									</span>
      									<span class="op-sign">
      										<strong>÷</strong>
      									</span>
      									<span class="op-bottom">
      										<strong>(-10)</strong>
      									</span>
      									<span class="op-sign">
      										<strong>=</strong>
      									</span>
      									<span class="op-result">
      										<strong>-6</strong>
      									</span>
      								</div>
               					 </div>

               					 </li>
               </ol>


               				             <iframe class="iframe" src="https://www.youtube.com/embed/-ngjIgOKwlk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>


               	 `
               },


               /* -------- D I V I S I Ó N  D E C I M A L E S -------- */
               divisionDecimales: {
               label: 'División con decimales', symbol: '&#247;',
               	generate: () => {
               	const randomChance = Math.floor(Math.random() * 5); // 0 a 4
               	let divisor, dividendo;

               	if (randomChance === 0) {
               		// Caso especial: 1 de cada 5 veces
               		const decimals = Math.random() < 0.5 ? 2 : 3;
               		divisor = +(Math.random() * 8 + 1).toFixed(decimals);

               		// 50% de las veces también aumenta la precisión del dividendo
               		dividendo = Math.random() < 0.5
               		? +(Math.random() * 90 + 10).toFixed(decimals)
               		: +(Math.random() * 90 + 10).toFixed(2);
               	} else {
               		// Caso normal
               		divisor = +(Math.random() * 8 + 1).toFixed(1);
               		dividendo = +(Math.random() * 90 + 10).toFixed(2);
               	}

               	return [dividendo, divisor];
               	},

               	calc: (a, b) => +(a / b).toFixed(4),

               instructions: `

               		 <h2>División con decimales</h2>
               <!-- ================== PARTE 1 ================== -->
               <h2 style="border-bottom: 2px solid #ccc; padding-bottom: 0.3em; margin-top: 1.5em;">
               🟢 Dividir si los decimales están en el dividendo
               </h2>

               <ol style="margin-bottom: 0em !important;">

               <li>
               Coloca el <strong>dividendo</strong> (el número que se va a dividir) a la izquierda y el <strong>divisor</strong> dentro del símbolo en forma de “L” invertida.
               <br>
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">45,6</div>
               <div class="divisor-wrapper">
               <div class="divisor">12&nbsp;&nbsp;</div>
               </div>
               </div>
               </li>

               <li>
               <strong>Empezamos dividiendo como si no hubiera coma</strong>. Tomamos las primeras cifras del número, en este caso <strong>45</strong>, y vemos cuántas veces cabe el 12 en ese número. Como 45 es más grande que 12, podemos dividir.
               <br>
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               <span class="pick">45</span>,6
               </div>
               <div class="divisor-wrapper">
               <div class="divisor">12&nbsp;&nbsp;</div>
               </div>
               </div>
               </li>

               <li>
               Calculamos cuántas veces cabe 12 en 45. La respuesta es <strong>3</strong> veces, ya que <strong>12 × 3 = 36</strong>. Escribimos el 3 en el cociente, realizamos la resta <strong>45 - 36 = 9</strong>, y bajamos la siguiente cifra.
               <br>
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               <span class="pick">45</span>,6
               <div class="step">-36&nbsp;&nbsp;
               <hr style="width: 2em !important;">
               </div>
               <div class="step">09&nbsp;&nbsp;</div>
               </div>
               <div class="divisor-wrapper">
               <div class="divisor">12&nbsp;&nbsp;</div>
               <div class="quotient">3</div>
               </div>
               </div>
               </li>

               <li>
               Ya no hay más cifras enteras por bajar, así que ahora <strong>bajamos el número que está después de la coma</strong>: el <strong>6</strong>. Muy importante: <strong>en cuanto bajamos la primera cifra decimal, debemos subir la coma al cociente</strong>. Así sabremos que el resultado ya no será un número entero.
               <br>
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               45,6
               <div class="step">-36&nbsp;&nbsp;
               <hr style="width: 2em !important;">
               </div>
               <div class="step">096&nbsp;</div>
               </div>
               <div class="divisor-wrapper">
               <div class="divisor">12&nbsp;&nbsp;</div>
               <div class="quotient">3,</div>
               </div>
               </div>
               </li>

               <li>
               Ahora dividimos 96 entre 12. Cabe <strong>8</strong> veces exactas, porque <strong>12 × 8 = 96</strong>. Escribimos el 8 después de la coma en el resultado y restamos.
               <br>
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               <span class="pick">45</span>,6
               <div class="step">-36&nbsp;&nbsp;
               <hr style="width: 2em !important;">
               </div>
               <div class="step">096&nbsp;</div>
               <div class="step">-&nbsp;96&nbsp;
               <hr style="width: 2.5em !important;">
               </div>
               <div class="remainder pick">0</div>&nbsp;
               </div>
               <div class="divisor-wrapper">
               <div class="divisor">12&nbsp;&nbsp;</div>
               <div class="quotient">3,8</div>
               </div>
               </div>
               </li>

               <li>
               El cociente final es <strong>3,8</strong>. Como el resto es 0, la división es exacta.
               </li>

               </ol>
               <!-- ================== PARTE 2 ================== -->
               <h2 style="border-bottom: 2px solid #ccc; padding-bottom: 0.3em; margin-top: 2em;">
               🔵 División con decimales en el divisor
               </h2>
               <ol>
               <p>Si el <strong>divisor</strong> tiene decimales, primero debemos convertirlo en un número entero. Para ello, usamos la <strong>propiedad invariante</strong>: multiplicamos tanto el dividendo como el divisor por la misma potencia de 10. Multiplicamos por 10 si hay un decimal, por 100 si hay dos, y así sucesivamente.</p>

               <li>Ejemplo: para calcular <strong>504 ÷ 4,2</strong>, multiplicamos ambos por 10 y obtenemos <strong>5040 ÷ 42</strong>, lo que da el mismo resultado.

               <div class="two-divisions">
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">592</div>
               <div class="divisor-wrapper">
               <div class="divisor">4,2&nbsp;</div>
               </div>
               </div>

               <span class="center-arrow">
               ×10

               <svg class="normal-arrow-divisions" version="1.0" xmlns="http://www.w3.org/2000/svg"
               width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000"
               preserveAspectRatio="xMidYMid meet">
               <metadata>
               Created by potrace 1.15, written by Peter Selinger 2001-2017
               </metadata>
               <g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)" stroke="none">
               <path d="M8590 5015 c0 -3 7 -19 15 -36 34 -65 185 -442 228 -569 92 -273 172
               -639 179 -827 l3 -63 -4508 0 -4507 0 0 -315 0 -315 4511 0 4511 0 -6 -67
               c-10 -99 -53 -352 -81 -473 -49 -219 -128 -447 -268 -780 -41 -96 -73 -176
               -72 -177 4 -6 348 140 1915 815 784 338 2102 911 2223 967 32 15 55 31 50 35
               -4 4 -55 28 -113 53 -58 25 -199 86 -315 137 -244 107 -485 212 -1572 681
               -692 299 -1791 769 -2160 926 -18 7 -33 11 -33 8z"/>
               </g>
               </svg>

               </span>



               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">5920</div>
               <div class="divisor-wrapper">
               <div class="divisor">42&nbsp;&nbsp;</div>
               </div>
               </div>
               </div>
               </li>

               <li>
               <strong>Comparamos</strong> las cifras iniciales del dividendo con el divisor. Si el dividendo es menor, tomamos una cifra más. En este caso, 52 es mayor que 42, por lo que podemos empezar a dividir.
               <br>
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               <span class="pick">52</span>90
               </div>
               <div class="divisor-wrapper">
               <div class="divisor">42&nbsp;&nbsp;</div>
               </div>
               </div>
               </li>

               <li>
               Realizamos la división normalmente para obtener las primeras cifras del cociente.
               <br>
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               <span class="pick">52</span>90
               <div class="step">-42&nbsp;&nbsp;<hr style="width: 2em;"></div>
               <div class="step">10&nbsp;&nbsp;</div>
               </div>
               <div class="divisor-wrapper">
               <div class="divisor">42&nbsp;&nbsp;</div>
               <div class="quotient">1</div>
               </div>
               </div>
               </li>

               <li>
               <strong>Bajamos el siguiente número</strong> y continuamos dividiendo.
               <br>
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               <span class="pick">52</span>90
               <div class="step">-42&nbsp;&nbsp;<hr style="width: 2em; margin-left: 0.32em"></div>
               <div class="step">109</div>
               <div class="step">-84&nbsp;<hr style="width: 2.5em; margin-left: 0.4em"></div>
               <div class="step">250</div>
               <div class="step">-210<hr style="width: 2.5em; margin-left: 1em"></div>
               <div class="remainder pick">40</div>
               </div>
               <div class="divisor-wrapper">
               <div class="divisor">42&nbsp;&nbsp;</div>
               <div class="quotient">125</div>
               </div>
               </div>
               </li>
               </ol>

               <!-- ================== PARTE 3 ================== -->
               <h2 style="border-bottom: 2px solid #ccc; padding-bottom: 0.3em; margin-top: 2em;">
               🟣 División con decimales en dividendo y divisor
               </h2>

               <p>
               Cuando <strong>ambos números tienen decimales</strong>, eliminamos la coma del divisor para convertirlo en entero. Para mantener el valor de la división, desplazamos también la coma del dividendo el mismo número de posiciones.
               </p>

               <p><strong>Ejemplo:</strong></p>
               <ol>
               <li>Si el dividendo tiene tres decimales y el divisor dos, multiplicamos por 100 (para quitar los decimales del divisor). No importa que el dividendo conserve decimales, pero el divisor no puede tenerlos.
               <br/>
               <div class="two-divisions">
               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">2,342</div>
               <div class="divisor-wrapper">
               <div class="divisor">3,65</div>
               </div>
               </div>

               <span class="center-arrow">
               ×100
               <svg class="normal-arrow-divisions" version="1.0" xmlns="http://www.w3.org/2000/svg"
               width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000"
               preserveAspectRatio="xMidYMid meet">
               <metadata>
               Created by potrace 1.15, written by Peter Selinger 2001-2017
               </metadata>
               <g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)" stroke="none">
               <path d="M8590 5015 c0 -3 7 -19 15 -36 34 -65 185 -442 228 -569 92 -273 172
               -639 179 -827 l3 -63 -4508 0 -4507 0 0 -315 0 -315 4511 0 4511 0 -6 -67
               c-10 -99 -53 -352 -81 -473 -49 -219 -128 -447 -268 -780 -41 -96 -73 -176
               -72 -177 4 -6 348 140 1915 815 784 338 2102 911 2223 967 32 15 55 31 50 35
               -4 4 -55 28 -113 53 -58 25 -199 86 -315 137 -244 107 -485 212 -1572 681
               -692 299 -1791 769 -2160 926 -18 7 -33 11 -33 8z"/>
               </g>
               </svg>

               </span>

               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">234,2</div>
               <div class="divisor-wrapper">
               <div class="divisor">365&nbsp;</div>
               </div>
               </div>
               </div>
               </li>

               <li>Luego, realizamos la división como ya vimos en el primer apartado. Este procedimiento es esencial cuando ambos números tienen decimales.</li>

               </ol>

               <iframe style="margin-top: 12px;" class="iframe" src="https://www.youtube.com/embed/tcCojLIto2g" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>




               <!-- ================== Extra: página 2 ================== -->
               <h2 style="border-bottom: 2px solid #ccc; padding-bottom: 0.3em; margin-top: 2em;">
               🟢 Extra: Sacar decimales a una división
               </h2>

               <ol>
               <p>Si al terminar el dividendo todavía queda resto, podemos continuar la división añadiendo una coma al cociente y ceros al dividendo. Cada cero que añadimos equivale a bajar una nueva cifra.</p>

               <!-- EJEMPLO COMPLETO: 27 ÷ 4 = 6,75 -->
               <li>Ejemplo: <strong>27 ÷ 4</strong>. Al dividir 27 entre 4 obtenemos 6 con resto 3.

               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               <span class="pick">27</span>
               <div class="step">-24<hr style="width: 2em;"></div>
               <div class="step">3</div>
               </div>
               <div class="divisor-wrapper">
               <div class="divisor">4&nbsp;&nbsp;&nbsp;</div>
               <div class="quotient">6</div>
               </div>
               </div>
               </li>

               <li>Como no quedan cifras pero sí resto, ponemos una coma al cociente, añadimos un 0 al resto (30) y seguimos dividiendo.

               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               27,<span class="pick">0</span>
               <div class="step">-24&nbsp;&nbsp;<hr style="width: 2em;"></div>
               <div class="step">30&nbsp;</div>
               <div class="step">-28&nbsp;<hr style="width: 2em; margin-left: 0.3em;"></div>
               <div class="step">2&nbsp;</div>
               </div>
               <div class="divisor-wrapper">
               <div class="divisor">4&nbsp;&nbsp;&nbsp;</div>
               <div class="quotient">6,7</div>
               </div>
               </div>
               </li>

               <li>Volvemos a añadir un 0: 20 ÷ 4 = 5. Ya no queda resto, así que hemos terminado.

               <div class="long-division">
               <div class="dividend-wrapper" style="position: relative;">
               27,<span class="pick">0</span>
               <div class="step">-24&nbsp;&nbsp;<hr style="width: 2em;"></div>
               <div class="step">30&nbsp;</div>
               <div class="step">-28&nbsp;<hr style="width: 2em; margin-left: 0.3em;"></div>
               <div class="step">2<span class="pick">0</span>
               <div class="step">-20<hr style="width: 2em; margin-left: 1em;"></div>
               <div class="remainder">0</div>
               </div>
               </div>
               <div class="divisor-wrapper">
               <div class="divisor">4&nbsp;&nbsp;&nbsp;</div>
               <div class="quotient">6,75</div>
               </div>
               </div>
               </li>
               <p>Resultado: <strong>27 ÷ 4 = 6,75</strong>. Añadir ceros nos permitió seguir dividiendo hasta obtener la parte decimal completa.</p>
               </ol>
               			   <iframe style="margin-top: 12px;" class="iframe" src="https://www.youtube.com/embed/NO0Qg0IEiuE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>





               </div>

               `
               },

               /* -------- D I V I S I Ó N  F R A C C I O N E S -------- */
               divisionFracciones: {
               label: 'División de fracciones', symbol: '&#247;',
               generate: () => {
               	  let f2;
               	  do {
               		  f2 = frac(rand(1, 8), rand(2, 9));
               	  } while (parseFrac(f2).n === 0);  // asegúrate de que el numerador del divisor no sea cero
               	  const f1 = frac(rand(1, 8), rand(2, 9));
               	  return [f1, f2];
               },
               calc: (a, b) => {
               	  const f1 = parseFrac(a), f2 = parseFrac(b);
               	  return (f1.n * f2.d) / (f1.d * f2.n);
               },
               instructions: `
              		 <h2>División de fracciones</h2>
                   <p>A continuación, veremos como resolver multiplicación de fracciones.</p>

               		 <ol>

                   <li>Pongamos el ejemplo de que tenemos esta <strong>división de fracciones con distinto denominador</strong>: <br/>

                <div class="operation" style="display: inline-block">
               	 <span class="frac"><span class="top">2</span><span class="bottom">3</span></span>
               	 <span class="op-sign">÷</span>
               	 <span class="frac"><span class="top">4</span><span class="bottom">5</span></span>
               	</span>
               </div>
               </li>

      <li>Las divisiones entre fracciones, se realizan mediante la multiplicación. Debes <strong>multiplicar en cruz</strong>, es decir, el numerador de la primera fracción por el denominador de la segunda y el denominador de la primera fracción por el numerador de la segunda.<br/>



               <div class="operation" style="display: inline-block">
               	 <div class="center">
                 <span class="frac"><span class="top">3</span><span class="bottom">4</span></span>
               	 <span class="op-sign">÷</span>
               	 <span class="frac"><span class="top">1</span><span class="bottom">2</span></span>

               	     <span class="width-arrow">
      <span class="equal">=</span>
               			</span>
               	 <span class="result"><span class="frac">
                  <span class="frac"><span class="top">3</span><span class="bottom">1</span></span>
               	  <span class="op-sign signo-center">×</span>
               	  <span class="frac"><span class="top">2</span><span class="bottom">4</span></span>
               	 </span></span>
               </div>
               </div>

               		   </li>




                  <li>Realiza la <strong>multiplicación</strong> y colocamos el resultado en forma de fracción. Este resultado es válido, pero también podemos simplificar la fracción, como ya hemos visto.<br>
                <div class="operation" style="display: inline-block">
               	 <span class="frac"><span class="top">6</span><span class="bottom">4</span></span>
               	</span>
               </div>
               		   </li>


               		 </ol>

                   <iframe class="iframe" src="https://www.youtube.com/embed/-ue3dAEUNT4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>



                   `
               },



               /* -------- D I V I S I Ó N  F R A C C I O N E S -------- */
               simplificarAmplificarFracciones: {
        label: '',
        symbol: '',
      generate: () => {
        const tipo = Math.random() < 0.5 ? 'simplificar' : 'amplificar';

        if (tipo === 'simplificar') {
          // Fracción amplificada para luego simplificar
          const baseNum = rand(1, 9);
          const baseDen = rand(2, 10);
          const factor = rand(2, 5);
          const num = baseNum * factor;
          const den = baseDen * factor;
          return [tipo, frac(num, den), factor];
        } else {
          // Fracción base y factor para amplificar
          const baseNum = rand(1, 9);
          const baseDen = rand(2, 10);
          const factor = rand(2, 5);
          return [tipo, frac(baseNum, baseDen), factor];
        }
      },
      /* ─────── dentro de OPERATIONS ─ simplificarAmplificarFracciones ─────── */
      calc: (tipo, fr /* factor no es necesario aquí */, factor) => {
        const { n, d } = parseFrac(fr);
        return n / d;          // ← SIEMPRE un número (p.e. 0.25)
      },
               instructions: `
              		 <h2>Simplificación y amplificación de fracciones</h2>

                   <h3><u>Amplificar una fracción</u></h3>



                   <p>En primer lugar, aprenderemos a amplificar una fracción. Veamos un ejemplo:</p>

                            		 <ol>

                <div class="operation" style="display: inline-block">
               	 <span class="frac">
                 <span class="top">4</span>
                 <span class="bottom">6</span>
                 </span>
               </div>
               </li>

      <li>Para amplificar una fracción, multiplica tanto el numerador como el denominador por el mismo número, distinto de <strong>0</strong> y <strong>1</strong>. En este caso, multiplicaremos por <strong>2</strong>. Es fundamental que ambos elementos de la fracción se multipliquen por el mismo número.</li>

               <div class="operation" style="display: inline-block">
               	 <div class="center">
                 <span class="frac"><span class="top">4 × 2</span><span class="bottom">6 × 2</span></span>

               	     <span class="width-arrow">
      <span class="equal">=</span>
               			</span>
               	 <span class="result">
                            <span class="frac"><span class="top">8</span><span class="bottom">12</span></span>
                            </span>
               </div>
               </div>

               		   </li>

                    <li>Ya tendríamos nuestra fracción amplificada. Ahora, haremos todo lo contrario, simplificar la fracción.</li>

                    </ol>
                  <h3><u>Simplificar una fracción</u></h3>



                   <p>Ahora aprovecharemos para aprender a simplificar, manteniendo el mismo ejemplo:</p>

                            		 <ol>

                <div class="operation" style="display: inline-block">
               	 <span class="frac">
                 <span class="top">4</span>
                 <span class="bottom">6</span>
                 </span>
               </div>
               </li>

      <li>Para simplificar una fracción, dividiremos tanto el numerador como el denominador por el mismo número. El número a dividir, <strong>debe ser divisor, tanto del numerador como del denominador</strong>. En nuestro ejemplo, también dividiremos entre <strong>2</strong>. Es fundamental que ambos elementos de la fracción se dividan por el mismo número.</li>

               <div class="operation" style="display: inline-block">
               	 <div class="center">
                 <span class="frac"><span class="top">4 ÷ 2</span><span class="bottom">6 ÷ 2</span></span>

               	     <span class="width-arrow">
      <span class="equal">=</span>
               			</span>
               	 <span class="result">
                            <span class="frac"><span class="top">2</span><span class="bottom">3</span></span>
                            </span>
               </div>
               </div>

               		   </li>

                    <li>Ya tendríamos nuestra fracción amplificada. Ahora, haremos todo lo contrario, simplificar la fracción.</li>
                </ol>

                   <iframe class="iframe" style="margin-top: 12px;" src="https://www.youtube.com/embed/SuXgLvWAwrY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>



                   `
               }

               };

               /* ---------------- L Ó G I C A  I N T E R A C T I V A ---------------- */
               let currentOpKey = 'tabla';
               let currentProblem = { a: 0, b: 0, answer: 0 };

               const tabs = document.querySelectorAll('.tab');
               const instructionSec = document.getElementById('instruction');
               const problemEl = document.getElementById('problem');
               const answerInput = document.getElementById('answerInput');
               const feedbackEl = document.getElementById('feedback');
               const checkBtn = document.getElementById('checkBtn');
               const newBtn = document.getElementById('newBtn');

               const isFractionOp = () => currentOpKey.endsWith('Fracciones');



               /* Cambia de pestaña */
               tabs.forEach(tab => {
               tab.addEventListener('click', () => {
               tabs.forEach(t => t.classList.remove('active'));
               tab.classList.add('active');
               currentOpKey = tab.dataset.op;
               loadOperation();
               });
               });


               function formatNumberES(n) {
               return String(n).replace('.', ',');
               }
               /* Devuelve un número en formato ES, sin ceros ni coma extra */
               function formatNumberSmart(n, maxDec = 4) {
               const fixed = Number(n).toFixed(maxDec)            // máx. 4 decimales
               .replace(/\.?0+$/, '');          // quita ceros/ver la coma
               return formatNumberES(fixed);                       // usa coma decimal
               }

               /* Construye y simplifica la fracción resultado según la operación */
               function getFractionResult(opKey, [v1, v2]) {
               const f1 = parseFrac(v1);
               const f2 = parseFrac(v2);
               let num, den;

               switch (opKey) {
               case 'sumaFracciones':
               	  den = lcm(f1.d, f2.d);
               	  num = f1.n * (den / f1.d) + f2.n * (den / f2.d);
               	  break;
               case 'restaFracciones':
               	  den = lcm(f1.d, f2.d);
               	  num = f1.n * (den / f1.d) - f2.n * (den / f2.d);
               	  break;
               case 'multiplicacionFracciones':
               	  num = f1.n * f2.n;
               	  den = f1.d * f2.d;
               	  break;
               case 'divisionFracciones':
               	  num = f1.n * f2.d;
               	  den = f1.d * f2.n;
               	  break;
                  case 'simplificarAmplificarFracciones':
                  const tipo = currentProblem.values[0];
                  const { n, d } = parseFrac(currentProblem.values[1]);
                  const factor = currentProblem.values[2];
                  if (tipo === 'simplificar') {
                    return reduceFrac({ n, d });
                  } else {
                    return { n: n * factor, d: d * factor };
                  }

               default:
               	  return null;
               }
               return reduceFrac({ n: num, d: den });
               }

               /* Devuelve HTML con la fracción “bonita”  */
               function formatFractionHTML({ n, d }) {
               return `<span class="frac"><span class="top">${n}</span><span class="bottom">${d}</span></span>`;
               }

               /* ─────────── utilidades ─────────── */

               let firstLoad = true;

               function loadOperation() {
               const op = OPERATIONS[currentOpKey];

               instructionSec.innerHTML = op.instructions;
               generateProblem();
               feedbackEl.textContent = '';

               const doScroll = !firstLoad;
               firstLoad = false;

               if (doScroll) {
               instructionSec.scrollIntoView({ behavior: 'smooth', block: 'start' });
               }

               setTimeout(() => {
               const target = currentOpKey.endsWith('Fracciones')
               	  ? document.getElementById('inputNum')
               	  : answerInput;
               focusSinScroll(target);
               }, doScroll ? 120 : 0);
               }
               /* Genera enunciado aleatorio */
      function generateProblem() {
        const op = OPERATIONS[currentOpKey];
        const values = op.generate();
        currentProblem = { values, answer: op.calc(...values) };

        /* ════════ CASOS CON RETURN INMEDIATO (ENTEROS) ════════ */
        if (['sumaEnteros', 'multiplicacionEnteros', 'divisionEnteros'].includes(currentOpKey)) {
          const [a, b] = values;
          const opSymbol = OPERATIONS[currentOpKey].symbol;
          const aStr = `(${a >= 0 ? '+' : ''}${a})`;
          const bStr = `(${b >= 0 ? '+' : ''}${b})`;
          problemEl.innerHTML = `${aStr} ${opSymbol} ${bStr} = `;
          return;
        }

        /* ── Formato fracción bonita ── */
        const formatValue = v => {
          const str = String(v).trim();
          if (str.includes('/')) {
            const [num, den] = str.split('/');
            return `
              <span class="frac">
                <span class="top">${num}</span>
                <span class="bottom">${den}</span>
              </span>`;
          }
          return formatNumberES(str);
        };

        /* ════════ POTENCIAS ════════ */
        if (currentOpKey === 'potencias') {
          const [base, exp] = values;
          problemEl.innerHTML = `
            <p>Halla el valor de:</p>
            <span class="number">${base}<sup>${exp}</sup></span> = ?`;
          return;
        }

        /* ════════ OPERACIONES COMBINADAS ════════ */
        if (currentOpKey === 'operacionesCombinadas') {
          const [exprStr] = values;
          const formatted = exprStr.replace(/\^(\d+)/g, '<sup>$1</sup>');
          problemEl.innerHTML = `
            ${formatted} = ?`;
          return;
        }

        /* ════════ SIMPLIFICAR / AMPLIFICAR FRACCIONES ════════ */
        if (currentOpKey === 'simplificarAmplificarFracciones') {
          const [tipo, fr, factor] = values;
          const [num, den] = fr.split('/');

          const actionText = tipo === 'simplificar'
            ? 'Simplifica la fracción:'
            : `Amplifica por <strong>${factor}</strong> la fracción:`;

          problemEl.innerHTML = `
            <p>${actionText}</p>
            <span class="frac">
              <span class="top">${num}</span>
              <span class="bottom">${den}</span>
            </span> = ?`;

          /* —— muestra inputs de fracción —— */
          answerInput.style.display = 'none';
          const fracContainerId = 'fracInput';
          let fracDiv = document.getElementById(fracContainerId);

          if (!fracDiv) {
            answerInput.insertAdjacentHTML('afterend', `
              <div class="frac" id="${fracContainerId}">
                <input type="number" id="inputNum" class="top-input" placeholder="n">
                <hr class="separator-frac"/>
                <input type="number" id="inputDen" class="bottom" placeholder="d">
              </div>`);
            fracDiv = document.getElementById(fracContainerId);
          }

          fracDiv.style.display = 'inline-block';
          fracDiv.querySelector('#inputNum').value = '';
          fracDiv.querySelector('#inputDen').value = '';

          return;
        }

        /* ════════ OTROS CASOS BINARIOS NORMALES ════════ */
        if (values.length === 2) {
          problemEl.innerHTML = `
            ${formatValue(values[0])}
            <span class="op-sign">${op.symbol}</span>
            ${formatValue(values[1])} = ?`;
        } else {
          if (currentOpKey === 'primos_compuestos') {
            const [a] = values;
            problemEl.innerHTML = `(${a}) = ?`;
          } else {
            problemEl.innerHTML = `
              ${op.label}(${values.map(formatValue).join(', ')}) = ?`;
          }
        }

        /* ════════ MANEJO DE INPUTS SEGÚN EL TIPO ════════ */
        const isFrac = currentOpKey.endsWith('Fracciones');
        const fracContainerId = 'fracInput';
        let fracDiv = document.getElementById(fracContainerId);

        if (isFrac) {
          answerInput.style.display = 'none';
          if (!fracDiv) {
            answerInput.insertAdjacentHTML('afterend', `
              <div class="frac" id="${fracContainerId}">
                <input type="number" id="inputNum" class="top-input" placeholder="n">
                <hr class="separator-frac"/>
                <input type="number" id="inputDen" class="bottom" placeholder="d">
              </div>`);
            fracDiv = document.getElementById(fracContainerId);
          }

          fracDiv.style.display = 'inline-block';
          fracDiv.querySelector('#inputNum').value = '';
          fracDiv.querySelector('#inputDen').value = '';
        } else {
          answerInput.style.display = 'inline-block';
          if (fracDiv) fracDiv.style.display = 'none';
          answerInput.value = '';
        }
      }



               /* Comprueba respuesta del alumnado */
               function checkAnswer() {
               const correctVal = currentProblem.answer;      // numérico (p.e. 0.4167…)
               const isFracOp = currentOpKey.endsWith('Fracciones');
               const userIsFrac = isFracOp;                   // solo las de fracción usan inputs dobles

        /* ── CASO ESPECIAL: descomposición en factores primos ──────────────── */
        if (currentOpKey === 'descomposicionPrimos') {
          // 1️⃣ Normaliza la entrada del usuario
          const userAnswer = answerInput.value
            .replace(/[xX*]/g, '×')   // convierte x, X o * en “×”
            .replace(/\s+/g, '')      // quita espacios
            .trim();

          // 2️⃣ Normaliza la respuesta correcta
          const correctAnswer = correctVal.replace(/\s+/g, '');   // "2×2×2"

          // 3️⃣ Compara
          const userOk = userAnswer === correctAnswer;

          // 4️⃣ Mensaje
          if (userOk) {
            feedbackEl.textContent = '¡Correcto! Bien hecho.';
            feedbackEl.style.color = '#15803d';
          } else {
            const prettyResult = correctVal.replace(/×/g, ' × ');
            feedbackEl.innerHTML =
              `Respuesta incorrecta. El resultado correcto es ${prettyResult}.`;
            feedbackEl.style.color = '#b91c1c';
          }
          return;   // 👈 IMPORTANTÍSIMO: salimos para no ejecutar el resto
        }


               /* 1️⃣ Obtén respuesta del usuario */
               let userOk = false;

               if (userIsFrac) {             // --- usuario escribió fracción ---
               const num = parseInt(document.getElementById("inputNum").value);
               const den = parseInt(document.getElementById("inputDen").value);

               if (isNaN(num) || isNaN(den) || den === 0) {
               	   feedbackEl.textContent = 'Por favor, introduce una fracción válida.';
               	   feedbackEl.style.color = '#b91c1c';
               	   return;
               }
               userOk = Math.abs(num / den - correctVal) < 1e-6;
               } else {                      // --- usuario escribió número ---
      // 1️⃣ Cadena original sin espacios laterales
      const raw = answerInput.value.trim();

      /*
       * 2️⃣ Normalización:
       *    – Si hay coma, la tratamos como separador decimal ➜
       *        · Quitamos todos los puntos (miles)   "1.234,56" → "1234,56"
       *        · Cambiamos la coma por punto         "1234,56"  → "1234.56"
       *    – Si NO hay coma, asumimos formato inglés.
       *        · Quitamos comas de millar opcionales "1,234.56" → "1234.56"
       */
      let numStr;
      if (raw.includes(',')) {
        numStr = raw.replace(/\./g, '').replace(',', '.');
      } else {
        numStr = raw.replace(/,/g, '');  // elimina comas de millar
      }

      // 3️⃣ Ahora sí convertimos
      const num = parseFloat(numStr);

               if (isNaN(num)) {
               	   feedbackEl.textContent = 'Por favor, introduce un número válido.';
               	   feedbackEl.style.color = '#b91c1c';
               	   return;
               }
      /* margen de 0,01 para cualquier resultado decimal */
      const tolerance = 1e-2;                 // ±0,01
      userOk = Math.abs(num - correctVal) < tolerance;

               }

               /* 2️⃣ Construye el resultado formateado */
               let prettyResult;

               if (isFracOp) {                                     // mostrar como fracción
               const fracRes = getFractionResult(currentOpKey, currentProblem.values);
               prettyResult = formatFractionHTML(fracRes);
               } else if (Number.isInteger(correctVal)) {          // entero
               prettyResult = formatNumberSmart(correctVal);
               } else {                                            // decimal
      prettyResult = formatNumberSmart(correctVal, 2);   // ← 2 decimales máx.

               }

               /* 3️⃣ Muestra el mensaje */
      /* 3️⃣ Muestra el mensaje */
      if (userOk) {
          feedbackEl.textContent = '¡Correcto! Bien hecho.';
          feedbackEl.style.color = '#15803d';
      } else {
          // Verifica si estás en la sección primos_compuestos
          if (currentOpKey === 'primos_compuestos' && Number.isInteger(correctVal)) {
              let tipo = '';
              if (correctVal === 1) {
                  tipo = '<strong>primo</strong>';
              } else if (correctVal === 2) {
                  tipo = '<strong>compuesto</strong>';
              }

              if (tipo) {
                  feedbackEl.innerHTML = `Respuesta incorrecta. El resultado es ${tipo}.`;
              } else {
                  feedbackEl.innerHTML = `Respuesta incorrecta. El resultado correcto es ${prettyResult}.`;
              }
          } else {
              feedbackEl.innerHTML = `Respuesta incorrecta. El resultado correcto es ${prettyResult}.`;
          }
          feedbackEl.style.color = '#b91c1c';
      }
               }


               /* Botones y teclado */
               checkBtn.addEventListener('click', checkAnswer);
               newBtn.addEventListener('click', () => {
               generateProblem();
               feedbackEl.textContent = '';
               answerInput.value = '';
               });

               answerInput.addEventListener('keyup', e => {
               if (e.key === 'Enter') checkAnswer();
               });

               /* Arranque inicial */
               loadOperation();

               const hamburgerBtn = document.getElementById('hamburgerBtn');
               const tabsContainer = document.getElementById('tabsContainer');

               hamburgerBtn.addEventListener('click', () => {
               tabsContainer.classList.toggle('show');
               });
    </script>
  </body>
</html>
